<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Energy Empire</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
            user-select: none;
        }
        
        body {
            background-color: #1a1a1a;
            color: #fff;
            overflow-x: hidden;
            transition: all 0.3s ease;
        }
        
        .container {
            max-width: 100%;
            padding: 10px;
            position: relative;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            position: relative;
        }
        
        .currency-display {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .currency-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .round-button {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #6e8efb, #a777e3);
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            border: none;
            outline: none;
        }
        
        .round-button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
        
        .round-button:active {
            transform: scale(0.95);
        }
        
        .main-content {
            margin: 20px 0;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            opacity: 1;
        }
        
        .main-content.hidden {
            opacity: 0;
            pointer-events: none;
            height: 0;
            margin: 0;
            overflow: hidden;
        }
        
        .navigation {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: #2a2a2a;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            border-top: 1px solid #444;
            z-index: 100;
        }
        
        .nav-button {
            padding: 10px 15px;
            border-radius: 20px;
            background-color: #333;
            color: white;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        
        .nav-button.active {
            background: linear-gradient(135deg, #6e8efb, #a777e3);
            box-shadow: 0 0 10px rgba(108, 140, 251, 0.5);
        }
        
        .nav-button:hover {
            transform: translateY(-3px);
        }
        
        .city-view {
            text-align: center;
        }
        
        .building {
            margin: 15px 0;
            padding: 15px;
            background-color: #333;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .building:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .building-image {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            background-color: #444;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
        }
        
        .building-info {
            flex: 1;
            text-align: left;
        }
        
        .building-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .building-level {
            font-size: 12px;
            color: #aaa;
        }
        
        .building-production {
            font-size: 12px;
            color: #6e8efb;
        }
        
        .building-price {
            font-weight: bold;
            color: #a777e3;
        }
        
        .shop-item {
            margin: 10px 0;
            padding: 15px;
            background-color: #333;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .shop-item:hover {
            background-color: #3a3a3a;
        }
        
        .shop-item-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .shop-item-image {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            background-color: #444;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
        }
        
        .shop-item-name {
            font-weight: bold;
        }
        
        .shop-item-price {
            font-weight: bold;
            color: #a777e3;
        }
        
        .premium-item {
            border: 2px solid gold;
            background-color: rgba(255, 215, 0, 0.1);
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
        }
        
        .modal.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .modal-content {
            background-color: #2a2a2a;
            padding: 20px;
            border-radius: 15px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            position: relative;
            transform: scale(0.9);
            transition: all 0.3s ease;
        }
        
        .modal.active .modal-content {
            transform: scale(1);
        }
        
        .close-modal {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }
        
        .roulette-container {
            text-align: center;
            padding: 20px;
        }
        
        .roulette-wheel {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: conic-gradient(
                #ff5733, #33ff57, #3357ff, #f3ff33, #ff33f3
            );
            margin: 20px auto;
            position: relative;
            transition: transform 3s cubic-bezier(0.17, 0.67, 0.12, 0.99);
            transform: rotate(0deg);
        }
        
        .roulette-pointer {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 20px solid red;
            z-index: 10;
        }
        
        .spin-button {
            padding: 10px 20px;
            background: linear-gradient(135deg, #6e8efb, #a777e3);
            color: white;
            border: none;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }
        
        .spin-button:hover {
            transform: scale(1.05);
        }
        
        .spin-button:disabled {
            background: #555;
            cursor: not-allowed;
        }
        
        .exchange-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }
        
        .exchange-input {
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #444;
            background-color: #333;
            color: white;
        }
        
        .exchange-button {
            padding: 10px;
            border-radius: 8px;
            border: none;
            background: linear-gradient(135deg, #6e8efb, #a777e3);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .exchange-button:hover {
            transform: scale(1.02);
        }
        
        .leaderboard {
            width: 100%;
            margin-top: 20px;
        }
        
        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background-color: #333;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .leaderboard-position {
            font-weight: bold;
            color: #a777e3;
        }
        
        .leaderboard-name {
            flex: 1;
            margin-left: 15px;
        }
        
        .leaderboard-value {
            font-weight: bold;
        }
        
        .premium-badge {
            background-color: gold;
            color: black;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 5px;
        }
        
        .premium-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }
        
        .premium-option {
            padding: 15px;
            background-color: #333;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .premium-option:hover {
            border-color: gold;
        }
        
        .premium-option-name {
            font-weight: bold;
            color: gold;
        }
        
        .premium-option-price {
            font-weight: bold;
        }
        
        .withdraw-notice {
            background-color: #333;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
            color: #aaa;
        }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background-color: #444;
            border-radius: 5px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #6e8efb, #a777e3);
            border-radius: 5px;
            transition: width 0.3s ease;
        }
        
        .event-item {
            background-color: #333;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        
        .event-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #6e8efb;
        }
        
        .event-description {
            font-size: 14px;
            color: #aaa;
            margin-bottom: 10px;
        }
        
        .event-reward {
            font-weight: bold;
            color: #a777e3;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .slide-up {
            animation: slideUp 0.3s ease forwards;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #333;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            z-index: 1001;
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .notification.show {
            opacity: 1;
            top: 30px;
        }
        
        .notification.success {
            background-color: #4CAF50;
        }
        
        .notification.error {
            background-color: #F44336;
        }
        
        .notification.warning {
            background-color: #FF9800;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="currency-display">
                <div class="currency-item">
                    <span id="energy-amount">0</span> Energy
                </div>
                <div class="currency-item">
                    <span id="gamma-amount">0</span> Gamma Coins
                </div>
                <div class="currency-item">
                    <span id="ton-amount">0</span> TON
                </div>
            </div>
            <div class="header-buttons">
                <button class="round-button" id="premium-button">üíé</button>
                <button class="round-button" id="energy-roulette-button">üé°</button>
                <button class="round-button" id="luck-roulette-button">üçÄ</button>
            </div>
        </div>
        
        <div class="main-content" id="city-view">
            <div class="city-view">
                <h2>Your City</h2>
                <div id="buildings-container"></div>
            </div>
        </div>
        
        <div class="main-content hidden" id="shop-view">
            <h2>Shop</h2>
            <div id="shop-items-container"></div>
        </div>
        
        <div class="main-content hidden" id="events-view">
            <h2>Events</h2>
            <div id="events-container"></div>
        </div>
        
        <div class="main-content hidden" id="leaderboard-view">
            <h2>Leaderboard</h2>
            <div class="leaderboard" id="leaderboard-container"></div>
        </div>
        
        <div class="main-content hidden" id="exchange-view">
            <h2>Exchange</h2>
            <div class="exchange-form">
                <select class="exchange-input" id="exchange-from">
                    <option value="energy">Energy</option>
                    <option value="gamma">Gamma Coins</option>
                    <option value="ton">TON</option>
                </select>
                <input type="number" class="exchange-input" id="exchange-amount" placeholder="Amount">
                <select class="exchange-input" id="exchange-to">
                    <option value="gamma">Gamma Coins</option>
                    <option value="ton">TON</option>
                    <option value="energy">Energy</option>
                </select>
                <button class="exchange-button" id="exchange-button">Exchange</button>
            </div>
            
            <h3 style="margin-top: 30px;">Deposit TON</h3>
            <div class="exchange-form">
                <input type="number" class="exchange-input" id="deposit-amount" placeholder="Amount (1-100 TON)" min="1" max="100">
                <button class="exchange-button" id="deposit-button">Deposit</button>
            </div>
            
            <h3 style="margin-top: 30px;">Withdraw TON</h3>
            <div class="withdraw-notice">
                <p>You can withdraw only after 100 days of playing</p>
                <div class="progress-bar">
                    <div class="progress-fill" id="withdraw-progress" style="width: 0%"></div>
                </div>
                <p id="withdraw-days">0/100 days</p>
                <input type="number" class="exchange-input" id="withdraw-amount" placeholder="Amount" disabled>
                <button class="exchange-button" id="withdraw-button" disabled>Withdraw</button>
            </div>
        </div>
        
        <div class="navigation">
            <button class="nav-button" data-view="events-view">Events</button>
            <button class="nav-button" data-view="shop-view">Shop</button>
            <button class="nav-button active" data-view="city-view">City</button>
            <button class="nav-button" data-view="leaderboard-view">Leaderboard</button>
            <button class="nav-button" data-view="exchange-view">Exchange</button>
        </div>
        
        <!-- Premium Modal -->
        <div class="modal" id="premium-modal">
            <div class="modal-content">
                <button class="close-modal">&times;</button>
                <h2>Premium Membership</h2>
                <p>Unlock exclusive benefits with Premium!</p>
                
                <div class="premium-options">
                    <div class="premium-option" id="premium-month">
                        <div>
                            <span class="premium-option-name">Premium (1 Month)</span>
                            <p>Access to exclusive buildings and features</p>
                        </div>
                        <span class="premium-option-price">5 TON</span>
                    </div>
                    
                    <div class="premium-option" id="premium-lifetime">
                        <div>
                            <span class="premium-option-name">Premium (Lifetime)</span>
                            <p>Lifetime access to all premium features</p>
                        </div>
                        <span class="premium-option-price">30 TON</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Energy Roulette Modal -->
        <div class="modal" id="energy-roulette-modal">
            <div class="modal-content">
                <button class="close-modal">&times;</button>
                <h2>Energy Roulette</h2>
                <p>Spin once per day to win Energy!</p>
                
                <div class="roulette-container">
                    <div class="roulette-wheel" id="energy-wheel">
                        <div class="roulette-pointer"></div>
                    </div>
                    <button class="spin-button" id="spin-energy-button">Spin (Free)</button>
                </div>
            </div>
        </div>
        
        <!-- Luck Roulette Modal -->
        <div class="modal" id="luck-roulette-modal">
            <div class="modal-content">
                <button class="close-modal">&times;</button>
                <h2>Luck Roulette</h2>
                <p>Spin for a chance to win TON!</p>
                <p>99% chance: 0.5-1 TON</p>
                <p>1% chance: 1-5 TON</p>
                
                <div class="roulette-container">
                    <div class="roulette-wheel" id="luck-wheel">
                        <div class="roulette-pointer"></div>
                    </div>
                    <button class="spin-button" id="spin-luck-button">Spin (1 TON)</button>
                </div>
            </div>
        </div>
        
        <!-- Building Upgrade Modal -->
        <div class="modal" id="upgrade-modal">
            <div class="modal-content">
                <button class="close-modal">&times;</button>
                <h2 id="upgrade-building-name">Upgrade Building</h2>
                <div id="upgrade-info-container"></div>
                <button class="exchange-button" id="upgrade-button">Upgrade</button>
            </div>
        </div>
        
        <!-- Payment Modal -->
        <div class="modal" id="payment-modal">
            <div class="modal-content">
                <button class="close-modal">&times;</button>
                <h2>Payment</h2>
                <p id="payment-description">Please send <span id="payment-amount">0</span> TON to:</p>
                <p id="payment-address">UQAmTM_EE8D6seecLKf-h8aXVQasliniDDQ52EvBj7PqExNr</p>
                <p>Scan QR code or copy address:</p>
                <div id="payment-qr" style="width: 200px; height: 200px; margin: 20px auto; background-color: white; padding: 10px;"></div>
                <p id="payment-status">Waiting for payment...</p>
                <button class="exchange-button" id="payment-copy-button">Copy Address</button>
                <button class="exchange-button" id="payment-check-button" style="margin-top: 10px;">Check Payment</button>
            </div>
        </div>
        
        <!-- Notification -->
        <div class="notification" id="notification"></div>
    </div>

    <script>
        // Game State
        const gameState = {
            energy: 0,
            gamma: 0,
            ton: 0,
            premium: false,
            premiumExpires: null,
            buildings: {
                solar: { level: 0, count: 0 },
                wind: { level: 0, count: 0 },
                water: { level: 0, count: 0 },
                nuclear: { level: 0, count: 0 }
            },
            lastEnergyRoulette: null,
            lastLuckRoulette: null,
            firstPlayDate: new Date().toISOString(),
            lastEnergyUpdate: new Date().toISOString()
        };

        // Building Data
        const buildingData = {
            solar: {
                name: "Solar Panel",
                basePrice: 7,
                baseProduction: 700,
                levelData: [
                    { price: 7, production: 700 },
                    { price: 10, production: 1000 },
                    { price: 37, production: 2100 },
                    { price: 54, production: 4400 },
                    { price: 107, production: 5700 }
                ]
            },
            wind: {
                name: "Wind Turbine",
                basePrice: 21,
                baseProduction: 2100,
                levelData: [
                    { price: 21, production: 2100 },
                    { price: 58, production: 4400 },
                    { price: 127, production: 5700 },
                    { price: 256, production: 9600 },
                    { price: 448, production: 17300 }
                ]
            },
            water: {
                name: "Water Generator",
                basePrice: 76,
                baseProduction: 5700,
                levelData: [
                    { price: 76, production: 5700 },
                    { price: 148, production: 9600 },
                    { price: 272, production: 17300 },
                    { price: 437, production: 26700 },
                    { price: 821, production: 48400 }
                ]
            },
            nuclear: {
                name: "Nuclear Plant",
                basePrice: 500,
                baseProduction: 50000,
                levelData: [
                    { price: 500, production: 50000 },
                    { price: 1000, production: 100000 },
                    { price: 2000, production: 200000 },
                    { price: 4000, production: 400000 },
                    { price: 8000, production: 800000 }
                ],
                premium: true
            }
        };

        // Shop Items
        const shopItems = [
            { id: "solar", name: "Solar Panel", price: 7, production: 700, premium: false },
            { id: "wind", name: "Wind Turbine", price: 21, production: 2100, premium: false },
            { id: "water", name: "Water Generator", price: 76, production: 5700, premium: false },
            { id: "nuclear", name: "Nuclear Plant", price: 500, production: 50000, premium: true }
        ];

        // Events
        const events = [
            {
                title: "Energy Surge",
                description: "All your buildings produce 20% more energy for the next 24 hours!",
                reward: "+20% production",
                active: false
            },
            {
                title: "Gamma Bonus",
                description: "Exchange rates for Gamma Coins are doubled for the next 12 hours!",
                reward: "2x Gamma exchange",
                active: false
            },
            {
                title: "Premium Discount",
                description: "Get 10% off on all premium purchases today only!",
                reward: "10% discount",
                active: false
            }
        ];

        // Leaderboard (simulated)
        let leaderboard = [];

        // DOM Elements
        const energyAmountEl = document.getElementById('energy-amount');
        const gammaAmountEl = document.getElementById('gamma-amount');
        const tonAmountEl = document.getElementById('ton-amount');
        const buildingsContainerEl = document.getElementById('buildings-container');
        const shopItemsContainerEl = document.getElementById('shop-items-container');
        const eventsContainerEl = document.getElementById('events-container');
        const leaderboardContainerEl = document.getElementById('leaderboard-container');
        const navButtons = document.querySelectorAll('.nav-button');
        const contentViews = document.querySelectorAll('.main-content');
        const premiumButton = document.getElementById('premium-button');
        const energyRouletteButton = document.getElementById('energy-roulette-button');
        const luckRouletteButton = document.getElementById('luck-roulette-button');
        const premiumModal = document.getElementById('premium-modal');
        const energyRouletteModal = document.getElementById('energy-roulette-modal');
        const luckRouletteModal = document.getElementById('luck-roulette-modal');
        const upgradeModal = document.getElementById('upgrade-modal');
        const paymentModal = document.getElementById('payment-modal');
        const notificationEl = document.getElementById('notification');
        const closeModalButtons = document.querySelectorAll('.close-modal');
        const premiumMonthOption = document.getElementById('premium-month');
        const premiumLifetimeOption = document.getElementById('premium-lifetime');
        const spinEnergyButton = document.getElementById('spin-energy-button');
        const spinLuckButton = document.getElementById('spin-luck-button');
        const energyWheel = document.getElementById('energy-wheel');
        const luckWheel = document.getElementById('luck-wheel');
        const upgradeButton = document.getElementById('upgrade-button');
        const upgradeInfoContainer = document.getElementById('upgrade-info-container');
        const exchangeFromEl = document.getElementById('exchange-from');
        const exchangeToEl = document.getElementById('exchange-to');
        const exchangeAmountEl = document.getElementById('exchange-amount');
        const exchangeButtonEl = document.getElementById('exchange-button');
        const depositAmountEl = document.getElementById('deposit-amount');
        const depositButtonEl = document.getElementById('deposit-button');
        const withdrawAmountEl = document.getElementById('withdraw-amount');
        const withdrawButtonEl = document.getElementById('withdraw-button');
        const withdrawProgressEl = document.getElementById('withdraw-progress');
        const withdrawDaysEl = document.getElementById('withdraw-days');
        const paymentDescriptionEl = document.getElementById('payment-description');
        const paymentAmountEl = document.getElementById('payment-amount');
        const paymentAddressEl = document.getElementById('payment-address');
        const paymentStatusEl = document.getElementById('payment-status');
        const paymentCopyButton = document.getElementById('payment-copy-button');
        const paymentCheckButton = document.getElementById('payment-check-button');
        const paymentQrEl = document.getElementById('payment-qr');

        // Current payment info
        let currentPayment = {
            type: null,
            amount: 0,
            timestamp: null,
            transactionHash: null
        };

        // Initialize the game
        function initGame() {
            // Load saved game state
            const savedState = localStorage.getItem('energyEmpireGameState');
            if (savedState) {
                Object.assign(gameState, JSON.parse(savedState));
                updateEnergyBasedOnTime();
            }

            // Update UI
            updateCurrencyDisplay();
            renderBuildings();
            renderShopItems();
            renderEvents();
            generateLeaderboard();
            updateWithdrawStatus();

            // Set up navigation
            setupNavigation();

            // Set up modals
            setupModals();

            // Set up buttons
            setupButtons();

            // Set up exchange
            setupExchange();

            // Set up payment
            setupPayment();

            // Check premium status
            checkPremiumStatus();

            // Generate QR code
            generateQRCode();
        }

        // Update energy based on time passed
        function updateEnergyBasedOnTime() {
            const now = new Date();
            const lastUpdate = new Date(gameState.lastEnergyUpdate);
            const diffHours = (now - lastUpdate) / (1000 * 60 * 60);
            
            if (diffHours > 0) {
                let totalProduction = 0;
                
                // Calculate production from all buildings
                for (const [buildingId, building] of Object.entries(gameState.buildings)) {
                    if (building.count > 0) {
                        const data = buildingData[buildingId];
                        const level = Math.min(building.level, data.levelData.length - 1);
                        const productionRate = data.levelData[level].production;
                        totalProduction += building.count * productionRate * diffHours;
                    }
                }
                
                if (totalProduction > 0) {
                    gameState.energy += Math.floor(totalProduction);
                    gameState.lastEnergyUpdate = now.toISOString();
                    saveGameState();
                    updateCurrencyDisplay();
                    renderBuildings();
                    showNotification(`+${Math.floor(totalProduction)} Energy generated while you were away!`, 'success');
                }
            }
        }

        // Update currency display
        function updateCurrencyDisplay() {
            energyAmountEl.textContent = formatNumber(gameState.energy);
            gammaAmountEl.textContent = formatNumber(gameState.gamma);
            tonAmountEl.textContent = formatNumber(gameState.ton);
            
            // Update premium button appearance
            if (gameState.premium) {
                premiumButton.style.background = 'linear-gradient(135deg, gold, orange)';
                premiumButton.style.boxShadow = '0 0 10px rgba(255, 215, 0, 0.5)';
            } else {
                premiumButton.style.background = 'linear-gradient(135deg, #6e8efb, #a777e3)';
                premiumButton.style.boxShadow = '0 4px 8px rgba(0, 0, 0, 0.2)';
            }
        }

        // Format large numbers
        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            }
            if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }

        // Render buildings in city view
        function renderBuildings() {
            buildingsContainerEl.innerHTML = '';
            
            for (const [buildingId, building] of Object.entries(gameState.buildings)) {
                if (building.count > 0 || buildingId === 'nuclear') {
                    const data = buildingData[buildingId];
                    const level = Math.min(building.level, data.levelData.length - 1);
                    const productionRate = data.levelData[level].production;
                    
                    const buildingEl = document.createElement('div');
                    buildingEl.className = 'building';
                    buildingEl.dataset.buildingId = buildingId;
                    
                    buildingEl.innerHTML = `
                        <div class="building-image">${getBuildingEmoji(buildingId)}</div>
                        <div class="building-info">
                            <div class="building-name">${data.name} ${buildingId === 'nuclear' && !gameState.premium ? '(Premium)' : ''}</div>
                            <div class="building-level">Level ${building.level + 1} (${building.count} owned)</div>
                            <div class="building-production">${productionRate} Energy/hour</div>
                        </div>
                        <div class="building-price">Upgrade: ${data.levelData[building.level + 1]?.price || 'MAX'} Gamma</div>
                    `;
                    
                    if (building.level < data.levelData.length - 1 && 
                        (buildingId !== 'nuclear' || gameState.premium)) {
                        buildingEl.addEventListener('click', () => openUpgradeModal(buildingId));
                    }
                    
                    buildingsContainerEl.appendChild(buildingEl);
                }
            }
            
            // Add animation to buildings
            const buildings = document.querySelectorAll('.building');
            buildings.forEach((building, index) => {
                building.style.animationDelay = `${index * 0.1}s`;
                building.classList.add('slide-up');
            });
        }

        // Get emoji for building
        function getBuildingEmoji(buildingId) {
            const emojis = {
                solar: '‚òÄÔ∏è',
                wind: 'üå¨Ô∏è',
                water: 'üíß',
                nuclear: '‚ò¢Ô∏è'
            };
            return emojis[buildingId] || 'üè†';
        }

        // Render shop items
        function renderShopItems() {
            shopItemsContainerEl.innerHTML = '';
            
            shopItems.forEach(item => {
                const shopItemEl = document.createElement('div');
                shopItemEl.className = `shop-item ${item.premium ? 'premium-item' : ''}`;
                shopItemEl.dataset.itemId = item.id;
                
                shopItemEl.innerHTML = `
                    <div class="shop-item-info">
                        <div class="shop-item-image">${getBuildingEmoji(item.id)}</div>
                        <div>
                            <div class="shop-item-name">${item.name} ${item.premium ? '(Premium)' : ''}</div>
                            <div>${item.production} Energy/hour</div>
                        </div>
                    </div>
                    <div class="shop-item-price">${item.price} Gamma</div>
                `;
                
                if (!item.premium || gameState.premium) {
                    shopItemEl.addEventListener('click', () => purchaseBuilding(item.id));
                } else {
                    shopItemEl.addEventListener('click', () => {
                        showNotification('Premium building! Get premium to unlock.', 'warning');
                    });
                }
                
                shopItemsContainerEl.appendChild(shopItemEl);
            });
            
            // Add animation to shop items
            const items = document.querySelectorAll('.shop-item');
            items.forEach((item, index) => {
                item.style.animationDelay = `${index * 0.1}s`;
                item.classList.add('slide-up');
            });
        }

        // Render events
        function renderEvents() {
            eventsContainerEl.innerHTML = '';
            
            events.forEach(event => {
                const eventEl = document.createElement('div');
                eventEl.className = 'event-item fade-in';
                
                eventEl.innerHTML = `
                    <div class="event-title">${event.title}</div>
                    <div class="event-description">${event.description}</div>
                    <div class="event-reward">Reward: ${event.reward}</div>
                `;
                
                eventsContainerEl.appendChild(eventEl);
            });
        }

        // Generate leaderboard
        function generateLeaderboard() {
            // Simulate leaderboard data
            if (leaderboard.length === 0) {
                leaderboard = [
                    { name: 'Player1', energy: 1500000, premium: true },
                    { name: 'Player2', energy: 1200000, premium: false },
                    { name: 'Player3', energy: 900000, premium: true },
                    { name: 'Player4', energy: 750000, premium: false },
                    { name: 'Player5', energy: 600000, premium: false },
                    { name: 'You', energy: gameState.energy, premium: gameState.premium }
                ].sort((a, b) => b.energy - a.energy);
            } else {
                // Update "You" in leaderboard
                const youIndex = leaderboard.findIndex(p => p.name === 'You');
                if (youIndex !== -1) {
                    leaderboard[youIndex].energy = gameState.energy;
                    leaderboard[youIndex].premium = gameState.premium;
                    leaderboard.sort((a, b) => b.energy - a.energy);
                }
            }
            
            // Render leaderboard
            leaderboardContainerEl.innerHTML = '';
            
            leaderboard.forEach((player, index) => {
                const playerEl = document.createElement('div');
                playerEl.className = 'leaderboard-item fade-in';
                playerEl.style.animationDelay = `${index * 0.1}s`;
                
                playerEl.innerHTML = `
                    <div class="leaderboard-position">#${index + 1}</div>
                    <div class="leaderboard-name">${player.name} ${player.premium ? '<span class="premium-badge">PREMIUM</span>' : ''}</div>
                    <div class="leaderboard-value">${formatNumber(player.energy)} Energy</div>
                `;
                
                leaderboardContainerEl.appendChild(playerEl);
            });
        }

        // Update withdraw status
        function updateWithdrawStatus() {
            const firstPlayDate = new Date(gameState.firstPlayDate);
            const now = new Date();
            const diffDays = Math.floor((now - firstPlayDate) / (1000 * 60 * 60 * 24));
            const progress = Math.min(diffDays, 100);
            
            withdrawProgressEl.style.width = `${progress}%`;
            withdrawDaysEl.textContent = `${diffDays}/100 days`;
            
            if (diffDays >= 100) {
                withdrawAmountEl.disabled = false;
                withdrawButtonEl.disabled = false;
                withdrawProgressEl.style.background = 'linear-gradient(135deg, #4CAF50, #8BC34A)';
            }
        }

        // Set up navigation
        function setupNavigation() {
            navButtons.forEach(button => {
                button.addEventListener('click', () => {
                    // Remove active class from all buttons
                    navButtons.forEach(btn => btn.classList.remove('active'));
                    // Add active class to clicked button
                    button.classList.add('active');
                    
                    // Hide all content views
                    contentViews.forEach(view => view.classList.add('hidden'));
                    
                    // Show selected content view
                    const viewId = button.dataset.view;
                    document.getElementById(viewId).classList.remove('hidden');
                    
                    // Update specific views if needed
                    if (viewId === 'leaderboard-view') {
                        generateLeaderboard();
                    }
                });
            });
        }

        // Set up modals
        function setupModals() {
            // Close modals when clicking X
            closeModalButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const modal = button.closest('.modal');
                    modal.classList.remove('active');
                });
            });
            
            // Close modals when clicking outside
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.classList.remove('active');
                    }
                });
            });
            
            // Premium modal
            premiumButton.addEventListener('click', () => {
                premiumModal.classList.add('active');
            });
            
            // Energy roulette modal
            energyRouletteButton.addEventListener('click', () => {
                energyRouletteModal.classList.add('active');
                
                // Check if already spun today
                if (gameState.lastEnergyRoulette) {
                    const lastSpin = new Date(gameState.lastEnergyRoulette);
                    const today = new Date();
                    
                    if (lastSpin.toDateString() === today.toDateString()) {
                        spinEnergyButton.disabled = true;
                        spinEnergyButton.textContent = 'Already spun today';
                    }
                }
            });
            
            // Luck roulette modal
            luckRouletteButton.addEventListener('click', () => {
                luckRouletteModal.classList.add('active');
                
                // Check if enough TON
                if (gameState.ton < 1) {
                    spinLuckButton.disabled = true;
                    spinLuckButton.textContent = 'Need 1 TON';
                }
            });
        }

        // Set up buttons
        function setupButtons() {
            // Spin energy roulette
            spinEnergyButton.addEventListener('click', spinEnergyRoulette);
            
            // Spin luck roulette
            spinLuckButton.addEventListener('click', spinLuckRoulette);
            
            // Premium options
            premiumMonthOption.addEventListener('click', () => initiatePayment('premium_month', 5));
            premiumLifetimeOption.addEventListener('click', () => initiatePayment('premium_lifetime', 30));
        }

        // Set up exchange
        function setupExchange() {
            exchangeButtonEl.addEventListener('click', exchangeCurrency);
            depositButtonEl.addEventListener('click', () => initiatePayment('deposit', parseFloat(depositAmountEl.value)));
            withdrawButtonEl.addEventListener('click', withdrawTon);
        }

        // Set up payment
        function setupPayment() {
            paymentCopyButton.addEventListener('click', () => {
                navigator.clipboard.writeText(paymentAddressEl.textContent);
                showNotification('Address copied to clipboard!', 'success');
            });
            
            paymentCheckButton.addEventListener('click', checkPayment);
        }

        // Generate QR code
        function generateQRCode() {
            // In a real app, you would use a QR code library
            paymentQrEl.innerHTML = `
                <div style="display: flex; justify-content: center; align-items: center; height: 100%; font-size: 10px; word-break: break-all;">
                    ${paymentAddressEl.textContent}
                </div>
            `;
        }

        // Open upgrade modal
        function openUpgradeModal(buildingId) {
            const building = gameState.buildings[buildingId];
            const data = buildingData[buildingId];
            const nextLevel = building.level + 1;
            
            if (nextLevel >= data.levelData.length) {
                showNotification('This building is already at maximum level!', 'warning');
                return;
            }
            
            const nextLevelData = data.levelData[nextLevel];
            
            upgradeInfoContainer.innerHTML = `
                <p>Upgrade ${data.name} to level ${nextLevel + 1}</p>
                <p>Cost: ${nextLevelData.price} Gamma Coins</p>
                <p>New production: ${nextLevelData.production} Energy/hour</p>
                <p>Current production: ${data.levelData[building.level].production} Energy/hour</p>
            `;
            
            upgradeButton.onclick = () => upgradeBuilding(buildingId);
            
            upgradeModal.classList.add('active');
        }

        // Upgrade building
        function upgradeBuilding(buildingId) {
            const building = gameState.buildings[buildingId];
            const data = buildingData[buildingId];
            const nextLevel = building.level + 1;
            
            if (nextLevel >= data.levelData.length) {
                showNotification('This building is already at maximum level!', 'warning');
                return;
            }
            
            const nextLevelData = data.levelData[nextLevel];
            
            if (gameState.gamma >= nextLevelData.price) {
                gameState.gamma -= nextLevelData.price;
                building.level = nextLevel;
                
                saveGameState();
                updateCurrencyDisplay();
                renderBuildings();
                upgradeModal.classList.remove('active');
                
                showNotification(`${data.name} upgraded to level ${nextLevel + 1}!`, 'success');
            } else {
                showNotification('Not enough Gamma Coins!', 'error');
            }
        }

        // Purchase building
        function purchaseBuilding(buildingId) {
            const building = gameState.buildings[buildingId];
            const data = buildingData[buildingId];
            
            if (gameState.gamma >= data.basePrice) {
                gameState.gamma -= data.basePrice;
                building.count += 1;
                
                if (building.level === 0) {
                    building.level = 0; // Initialize level if not set
                }
                
                saveGameState();
                updateCurrencyDisplay();
                renderBuildings();
                renderShopItems();
                
                showNotification(`${data.name} purchased!`, 'success');
            } else {
                showNotification('Not enough Gamma Coins!', 'error');
            }
        }

        // Spin energy roulette
        function spinEnergyRoulette() {
            // Check if already spun today
            if (gameState.lastEnergyRoulette) {
                const lastSpin = new Date(gameState.lastEnergyRoulette);
                const today = new Date();
                
                if (lastSpin.toDateString() === today.toDateString()) {
                    showNotification('You can only spin once per day!', 'error');
                    return;
                }
            }
            
            // Disable button during spin
            spinEnergyButton.disabled = true;
            
            // Random reward between 100 and 2000 energy
            const reward = Math.floor(Math.random() * 1901) + 100;
            
            // Spin animation
            const spins = 3 + Math.random() * 2; // 3-5 spins
            const duration = 3000; // 3 seconds
            const startRotation = 0;
            const endRotation = spins * 360 + (reward / 2000) * 360;
            
            let startTime = null;
            
            function animateSpin(timestamp) {
                if (!startTime) startTime = timestamp;
                const progress = (timestamp - startTime) / duration;
                
                if (progress < 1) {
                    const rotation = startRotation + (endRotation - startRotation) * easeOutCubic(progress);
                    energyWheel.style.transform = `rotate(${rotation}deg)`;
                    requestAnimationFrame(animateSpin);
                } else {
                    energyWheel.style.transform = `rotate(${endRotation}deg)`;
                    
                    // Add reward
                    gameState.energy += reward;
                    gameState.lastEnergyRoulette = new Date().toISOString();
                    saveGameState();
                    updateCurrencyDisplay();
                    
                    // Show reward
                    setTimeout(() => {
                        showNotification(`You won ${reward} Energy!`, 'success');
                        spinEnergyButton.disabled = false;
                        spinEnergyButton.textContent = 'Come back tomorrow';
                    }, 500);
                }
            }
            
            requestAnimationFrame(animateSpin);
        }

        // Spin luck roulette
        function spinLuckRoulette() {
            // Check if enough TON
            if (gameState.ton < 1) {
                showNotification('You need at least 1 TON to spin!', 'error');
                return;
            }
            
            // Deduct 1 TON
            gameState.ton -= 1;
            saveGameState();
            updateCurrencyDisplay();
            
            // Disable button during spin
            spinLuckButton.disabled = true;
            
            // Determine reward
            let reward;
            const rand = Math.random();
            
            // 99% chance: 0.5-1 TON
            // 1% chance: 1-5 TON
            if (rand < 0.99) {
                reward = 0.5 + Math.random() * 0.5; // 0.5-1
            } else {
                reward = 1 + Math.random() * 4; // 1-5
            }
            
            reward = parseFloat(reward.toFixed(2));
            
            // Spin animation
            const spins = 3 + Math.random() * 2; // 3-5 spins
            const duration = 3000; // 3 seconds
            const startRotation = 0;
            const endRotation = spins * 360 + (reward / 5) * 360;
            
            let startTime = null;
            
            function animateSpin(timestamp) {
                if (!startTime) startTime = timestamp;
                const progress = (timestamp - startTime) / duration;
                
                if (progress < 1) {
                    const rotation = startRotation + (endRotation - startRotation) * easeOutCubic(progress);
                    luckWheel.style.transform = `rotate(${rotation}deg)`;
                    requestAnimationFrame(animateSpin);
                } else {
                    luckWheel.style.transform = `rotate(${endRotation}deg)`;
                    
                    // Add reward
                    gameState.ton += reward;
                    gameState.lastLuckRoulette = new Date().toISOString();
                    saveGameState();
                    updateCurrencyDisplay();
                    
                    // Show reward
                    setTimeout(() => {
                        if (reward >= 1) {
                            showNotification(`JACKPOT! You won ${reward} TON!`, 'success');
                        } else {
                            showNotification(`You won ${reward} TON!`, 'success');
                        }
                        
                        // Re-enable button if enough TON
                        if (gameState.ton >= 1) {
                            spinLuckButton.disabled = false;
                            spinLuckButton.textContent = 'Spin (1 TON)';
                        } else {
                            spinLuckButton.textContent = 'Need 1 TON';
                        }
                    }, 500);
                }
            }
            
            requestAnimationFrame(animateSpin);
        }

        // Easing function for smooth animation
        function easeOutCubic(x) {
            return 1 - Math.pow(1 - x, 3);
        }

        // Exchange currency
        function exchangeCurrency() {
            const from = exchangeFromEl.value;
            const to = exchangeToEl.value;
            const amount = parseFloat(exchangeAmountEl.value);
            
            if (isNaN(amount) || amount <= 0) {
                showNotification('Please enter a valid amount!', 'error');
                return;
            }
            
            // Check if player has enough to exchange
            if (gameState[from] < amount) {
                showNotification(`Not enough ${from}!`, 'error');
                return;
            }
            
            // Perform exchange
            let result = 0;
            
            // Energy to Gamma
            if (from === 'energy' && to === 'gamma') {
                result = Math.floor(amount / 1000) * 10;
            }
            // Gamma to TON
            else if (from === 'gamma' && to === 'ton') {
                result = amount / 10000;
            }
            // TON to Gamma
            else if (from === 'ton' && to === 'gamma') {
                result = amount * 10000;
            }
            // Gamma to Energy
            else if (from === 'gamma' && to === 'energy') {
                result = amount * 1000;
            }
            // Invalid combination
            else {
                showNotification('Invalid exchange pair!', 'error');
                return;
            }
            
            if (result <= 0) {
                showNotification('Exchange amount too small!', 'error');
                return;
            }
            
            // Apply exchange
            gameState[from] -= amount;
            gameState[to] += result;
            
            saveGameState();
            updateCurrencyDisplay();
            
            showNotification(`Exchanged ${amount} ${from} for ${result} ${to}!`, 'success');
            
            // Clear input
            exchangeAmountEl.value = '';
        }

        // Initiate payment
        function initiatePayment(type, amount) {
            if (type === 'withdraw') {
                if (amount > gameState.ton) {
                    showNotification('Not enough TON to withdraw!', 'error');
                    return;
                }
                
                currentPayment = {
                    type,
                    amount,
                    timestamp: new Date().toISOString(),
                    transactionHash: null
                };
                
                paymentDescriptionEl.textContent = `Withdraw ${amount} TON to your wallet:`;
                paymentAmountEl.textContent = amount;
                paymentStatusEl.textContent = 'Processing withdrawal...';
                
                // In a real app, you would initiate a blockchain transaction here
                // For simulation, we'll just complete it after a delay
                setTimeout(() => {
                    completePayment();
                }, 3000);
                
                paymentModal.classList.add('active');
                return;
            }
            
            if (type === 'deposit') {
                if (amount < 1 || amount > 100) {
                    showNotification('Deposit amount must be between 1 and 100 TON!', 'error');
                    return;
                }
                
                paymentDescriptionEl.textContent = `Please send ${amount} TON to:`;
                paymentAmountEl.textContent = amount;
                paymentStatusEl.textContent = 'Waiting for payment...';
            } 
            else if (type === 'premium_month') {
                paymentDescriptionEl.textContent = 'Please send 5 TON to activate Premium for 1 month:';
                paymentAmountEl.textContent = '5';
                paymentStatusEl.textContent = 'Waiting for payment...';
            } 
            else if (type === 'premium_lifetime') {
                paymentDescriptionEl.textContent = 'Please send 30 TON to activate Premium for lifetime:';
                paymentAmountEl.textContent = '30';
                paymentStatusEl.textContent = 'Waiting for payment...';
            }
            
            currentPayment = {
                type,
                amount,
                timestamp: new Date().toISOString(),
                transactionHash: null
            };
            
            paymentModal.classList.add('active');
        }

        // Check payment
        function checkPayment() {
            // In a real app, you would check the blockchain for the transaction
            // For simulation, we'll just complete it after a delay
            paymentStatusEl.textContent = 'Checking payment...';
            
            setTimeout(() => {
                completePayment();
            }, 2000);
        }

        // Complete payment
        function completePayment() {
            if (currentPayment.type === 'deposit') {
                gameState.ton += currentPayment.amount;
                showNotification(`Deposited ${currentPayment.amount} TON!`, 'success');
            } 
            else if (currentPayment.type === 'premium_month') {
                gameState.premium = true;
                const expires = new Date();
                expires.setMonth(expires.getMonth() + 1);
                gameState.premiumExpires = expires.toISOString();
                showNotification('Premium activated for 1 month!', 'success');
            } 
            else if (currentPayment.type === 'premium_lifetime') {
                gameState.premium = true;
                gameState.premiumExpires = null; // null means lifetime
                showNotification('Premium activated for lifetime!', 'success');
            }
            else if (currentPayment.type === 'withdraw') {
                gameState.ton -= currentPayment.amount;
                showNotification(`Withdrew ${currentPayment.amount} TON!`, 'success');
            }
            
            saveGameState();
            updateCurrencyDisplay();
            renderBuildings();
            renderShopItems();
            
            paymentStatusEl.textContent = 'Payment completed!';
            setTimeout(() => {
                paymentModal.classList.remove('active');
            }, 1500);
        }

        // Withdraw TON
        function withdrawTon() {
            const amount = parseFloat(withdrawAmountEl.value);
            
            if (isNaN(amount) || amount <= 0) {
                showNotification('Please enter a valid amount!', 'error');
                return;
            }
            
            if (amount > gameState.ton) {
                showNotification('Not enough TON to withdraw!', 'error');
                return;
            }
            
            initiatePayment('withdraw', amount);
        }

        // Check premium status
        function checkPremiumStatus() {
            if (gameState.premium && gameState.premiumExpires) {
                const expires = new Date(gameState.premiumExpires);
                const now = new Date();
                
                if (now > expires) {
                    gameState.premium = false;
                    gameState.premiumExpires = null;
                    saveGameState();
                    updateCurrencyDisplay();
                    renderBuildings();
                    renderShopItems();
                    
                    showNotification('Your Premium membership has expired!', 'warning');
                }
            }
        }

        // Show notification
        function showNotification(message, type = 'info') {
            notificationEl.textContent = message;
            notificationEl.className = 'notification';
            notificationEl.classList.add(type);
            notificationEl.classList.add('show');
            
            setTimeout(() => {
                notificationEl.classList.remove('show');
            }, 3000);
        }

        // Save game state
        function saveGameState() {
            gameState.lastEnergyUpdate = new Date().toISOString();
            localStorage.setItem('energyEmpireGameState', JSON.stringify(gameState));
        }

        // Initialize the game when DOM is loaded
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
