<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Energy Empire</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --primary: #0088cc;
            --premium: #f1c40f;
            --energy: #f39c12;
            --gamma: #3498db;
            --ton: #9b59b6;
        }
        
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
            position: relative;
        }
        
        .top-buttons {
            position: fixed;
            top: 10px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 10px;
            box-sizing: border-box;
            z-index: 100;
        }
        
        .round-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            border: none;
        }
        
        .energy-wheel {
            background-color: var(--energy);
            color: white;
        }
        
        .luck-wheel {
            background-color: var(--ton);
            color: white;
        }
        
        .premium-btn {
            background-color: var(--premium);
            color: #333;
            font-weight: bold;
        }
        
        .container {
            max-width: 100%;
            padding: 70px 10px 80px;
            box-sizing: border-box;
        }
        
        .balance-container {
            display: flex;
            justify-content: space-around;
            background-color: white;
            padding: 15px 10px;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .balance-item {
            text-align: center;
            flex: 1;
        }
        
        .balance-icon {
            font-size: 20px;
            margin-bottom: 5px;
        }
        
        .balance-value {
            font-weight: bold;
            font-size: 16px;
        }
        
        #energy { color: var(--energy); }
        #gamma { color: var(--gamma); }
        #ton { color: var(--ton); }
        
        .content {
            background-color: white;
            padding: 15px;
            border-radius: 10px;
            min-height: 200px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 15px;
        }
        
        .nav-bar {
            display: flex;
            justify-content: space-around;
            background-color: white;
            padding: 10px 0;
            position: fixed;
            bottom: 0;
            width: 100%;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 100;
        }
        
        .nav-button {
            text-align: center;
            padding: 5px;
            cursor: pointer;
            flex: 1;
            transition: all 0.3s;
        }
        
        .nav-button.active {
            color: var(--primary);
            transform: translateY(-5px);
        }
        
        .nav-button .icon {
            font-size: 24px;
            margin-bottom: 3px;
        }
        
        .nav-button .label {
            font-size: 12px;
        }
        
        .building {
            border: 1px solid #eee;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            background-color: #fafafa;
            transition: all 0.3s;
        }
        
        .building:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .building-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .building-name {
            font-weight: bold;
            font-size: 18px;
        }
        
        .building-price {
            color: #e74c3c;
            font-weight: bold;
            font-size: 16px;
        }
        
        .building-income {
            color: #27ae60;
            margin-bottom: 12px;
            font-size: 14px;
        }
        
        .building-level {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .level-btn {
            width: 23%;
            padding: 5px;
            border-radius: 5px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .level-btn:hover {
            background: #f0f0f0;
        }
        
        .level-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .buy-btn {
            background: linear-gradient(135deg, var(--primary), #00c8ff);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .buy-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }
        
        .premium-badge {
            background-color: var(--premium);
            color: #333;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 12px;
            margin-left: 8px;
            font-weight: bold;
        }
        
        .city-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .city-cell {
            aspect-ratio: 1/1;
            background-color: #ecf0f1;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .wheel-container {
            text-align: center;
            padding: 20px;
        }
        
        .wheel-result {
            font-size: 24px;
            font-weight: bold;
            margin: 20px 0;
            padding: 10px;
            border-radius: 10px;
            background-color: #f8f9fa;
        }
        
        .spin-btn {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            margin-top: 20px;
        }
        
        .exchange-form {
            margin-top: 15px;
        }
        
        .exchange-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        
        .exchange-btn {
            background: linear-gradient(135deg, var(--gamma), #3498db);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
        }
        
        .premium-options {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        .premium-option {
            width: 48%;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid var(--premium);
        }
        
        .premium-option:hover {
            background-color: rgba(241, 196, 15, 0.1);
        }
        
        .premium-title {
            font-weight: bold;
            color: var(--premium);
            margin-bottom: 5px;
        }
        
        .premium-price {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .withdraw-info {
            font-size: 12px;
            color: #777;
            margin-top: 10px;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #2ecc71;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 1000;
            animation: fadeInOut 2.5s;
            display: none;
        }
        
        @keyframes fadeInOut {
            0% { opacity: 0; top: 10px; }
            10% { opacity: 1; top: 20px; }
            90% { opacity: 1; top: 20px; }
            100% { opacity: 0; top: 10px; }
        }
    </style>
</head>
<body>
    <div class="notification" id="notification"></div>
    
    <div class="top-buttons">
        <div>
            <button class="round-btn energy-wheel" onclick="showSection('energy-wheel')">‚ö°</button>
            <button class="round-btn luck-wheel" onclick="showSection('luck-wheel')">üçÄ</button>
        </div>
        <button class="round-btn premium-btn" onclick="showPremiumModal()">üíé</button>
    </div>
    
    <div class="container">
        <div class="balance-container">
            <div class="balance-item">
                <div class="balance-icon">‚ö°</div>
                <div>–≠–Ω–µ—Ä–≥–∏—è</div>
                <div class="balance-value" id="energy">0</div>
            </div>
            <div class="balance-item">
                <div class="balance-icon">Œì</div>
                <div>Gamma Coin</div>
                <div class="balance-value" id="gamma">0</div>
            </div>
            <div class="balance-item">
                <div class="balance-icon">üíé</div>
                <div>TON</div>
                <div class="balance-value" id="ton">0</div>
            </div>
        </div>
        
        <div class="content" id="content">
            <h2 id="content-title">üèôÔ∏è –í–∞—à –≥–æ—Ä–æ–¥</h2>
            <div id="content-text">
                <p>–í–∞—à–∏ –∑–¥–∞–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç —ç–Ω–µ—Ä–≥–∏—é</p>
                <div class="city-grid" id="city-grid"></div>
                <div id="city-stats"></div>
            </div>
        </div>
    </div>
    
    <div class="nav-bar">
        <div class="nav-button" id="events-btn" onclick="showSection('events')">
            <div class="icon">üé≤</div>
            <div class="label">–ò–≤–µ–Ω—Ç—ã</div>
        </div>
        <div class="nav-button" id="shop-btn" onclick="showSection('shop')">
            <div class="icon">üõí</div>
            <div class="label">–ú–∞–≥–∞–∑–∏–Ω</div>
        </div>
        <div class="nav-button active" id="city-btn" onclick="showSection('city')">
            <div class="icon">üèôÔ∏è</div>
            <div class="label">–ì–æ—Ä–æ–¥</div>
        </div>
        <div class="nav-button" id="leaderboard-btn" onclick="showSection('leaderboard')">
            <div class="icon">üèÜ</div>
            <div class="label">–õ–∏–¥–µ—Ä—ã</div>
        </div>
        <div class="nav-button" id="exchange-btn" onclick="showSection('exchange')">
            <div class="icon">üí±</div>
            <div class="label">–û–±–º–µ–Ω</div>
        </div>
    </div>

    <!-- –ü—Ä–µ–º–∏—É–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
    <div id="premium-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: white; padding: 20px; border-radius: 10px; width: 90%; max-width: 400px;">
            <h2 style="text-align: center; color: var(--premium);">Premium –°—Ç–∞—Ç—É—Å</h2>
            <div class="premium-options">
                <div class="premium-option" onclick="buyPremium('monthly')">
                    <div class="premium-title">Premium –Ω–∞ –º–µ—Å—è—Ü</div>
                    <div class="premium-price">5 üíé</div>
                    <div>–î–æ—Å—Ç—É–ø –∫ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–º –∑–¥–∞–Ω–∏—è–º</div>
                </div>
                <div class="premium-option" onclick="buyPremium('lifetime')">
                    <div class="premium-title">Premium –Ω–∞–≤—Å–µ–≥–¥–∞</div>
                    <div class="premium-price">30 üíé</div>
                    <div>–í–µ—á–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º</div>
                </div>
            </div>
            <button onclick="document.getElementById('premium-modal').style.display='none'" style="margin-top: 20px; width: 100%; padding: 10px; background: #e74c3c; color: white; border: none; border-radius: 5px; cursor: pointer;">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        let gameState = {
            balance: {
                energy: 0,
                gamma: 0,
                ton: 0
            },
            buildings: {
                solar: { level: 1, count: 0 },
                wind: { level: 1, count: 0 },
                water: { level: 1, count: 0 },
                nuclear: { level: 1, count: 0 }
            },
            premium: {
                active: false,
                type: null, // 'monthly' –∏–ª–∏ 'lifetime'
                expiry: null // –¥–ª—è –º–µ—Å—è—á–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏
            },
            lastUpdate: Date.now(),
            lastEnergySpin: 0,
            lastLuckSpin: 0,
            depositHistory: [],
            withdrawHistory: []
        };
        
        // –î–∞–Ω–Ω—ã–µ –æ –∑–¥–∞–Ω–∏—è—Ö
        const buildingsData = {
            solar: {
                name: "–°–æ–ª–Ω–µ—á–Ω–∞—è –±–∞—Ç–∞—Ä–µ—è",
                emoji: "‚òÄÔ∏è",
                levels: {
                    1: { price: 7, income: 700 },
                    2: { price: 10, income: 1000 },
                    3: { price: 37, income: 2100 },
                    4: { price: 54, income: 4400 },
                    5: { price: 107, income: 5700 }
                }
            },
            wind: {
                name: "–í–æ–∑–¥—É—à–Ω–∞—è –±–∞—Ç–∞—Ä–µ—è",
                emoji: "üå¨Ô∏è",
                levels: {
                    1: { price: 21, income: 2100 },
                    2: { price: 58, income: 4400 },
                    3: { price: 127, income: 5700 },
                    4: { price: 256, income: 9600 },
                    5: { price: 448, income: 17300 }
                }
            },
            water: {
                name: "–í–æ–¥–Ω–∞—è –±–∞—Ç–∞—Ä–µ—è",
                emoji: "üåä",
                levels: {
                    1: { price: 76, income: 5700 },
                    2: { price: 148, income: 9600 },
                    3: { price: 272, income: 17300 },
                    4: { price: 437, income: 26700 },
                    5: { price: 821, income: 48400 }
                }
            },
            nuclear: {
                name: "–Ø–¥–µ—Ä–Ω—ã–π —Ä–µ–∞–∫—Ç–æ—Ä",
                emoji: "‚ò¢Ô∏è",
                premium: true,
                levels: {
                    1: { price: 150, income: 15000 },
                    2: { price: 300, income: 30000 },
                    3: { price: 600, income: 60000 },
                    4: { price: 1200, income: 120000 },
                    5: { price: 2400, income: 240000 }
                }
            }
        };
        
        // –ö—É—Ä—Å—ã –æ–±–º–µ–Ω–∞
        const exchangeRates = {
            energyToGamma: 10000,
            gammaToTon: 10000000,
            tonToGamma: 2000000 // 1 TON = 2 000 000 Gamma (–∏–∑ –≤–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö: 5 TON = 10 000 000 Gamma)
        };
        
        // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function showNotification(text) {
            const notif = document.getElementById('notification');
            notif.textContent = text;
            notif.style.display = 'block';
            setTimeout(() => {
                notif.style.display = 'none';
            }, 2500);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
        function updateBalance() {
            document.getElementById('energy').textContent = Math.floor(gameState.balance.energy).toLocaleString();
            document.getElementById('gamma').textContent = Math.floor(gameState.balance.gamma).toLocaleString();
            document.getElementById('ton').textContent = Math.floor(gameState.balance.ton).toLocaleString();
        }
        
        // –†–∞—Å—á–µ—Ç –¥–æ—Ö–æ–¥–∞
        function calculateIncome() {
            const now = Date.now();
            const hoursPassed = (now - gameState.lastUpdate) / 1000 / 3600;
            
            let incomePerHour = 0;
            for (const [type, building] of Object.entries(gameState.buildings)) {
                if (buildingsData[type] && building.count > 0) {
                    const levelData = buildingsData[type].levels[building.level];
                    incomePerHour += building.count * levelData.income;
                }
            }
            
            const earnedEnergy = incomePerHour * hoursPassed;
            gameState.balance.energy += earnedEnergy;
            gameState.lastUpdate = now;
            
            if (earnedEnergy > 0) {
                showNotification(`+${Math.floor(earnedEnergy)} ‚ö° (${Math.floor(incomePerHour)}/—á–∞—Å)`);
            }
            
            return earnedEnergy;
        }
        
        // –ü–æ–∫—É–ø–∫–∞ –∑–¥–∞–Ω–∏—è
        function buyBuilding(type) {
            const building = buildingsData[type];
            const currentLevel = gameState.buildings[type].level;
            const levelData = building.levels[currentLevel];
            
            if (building.premium && !gameState.premium.active) {
                showNotification("–¢—Ä–µ–±—É–µ—Ç—Å—è Premium —Å—Ç–∞—Ç—É—Å!");
                return;
            }
            
            if (gameState.balance.gamma >= levelData.price) {
                gameState.balance.gamma -= levelData.price;
                gameState.buildings[type].count += 1;
                
                updateBalance();
                showSection('shop');
                showNotification(`–ö—É–ø–ª–µ–Ω–æ: ${building.name} (–£—Ä. ${currentLevel})`);
                
                // –í–∏–±—Ä–∞—Ü–∏—è –Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
                if (navigator.vibrate) navigator.vibrate(50);
            } else {
                showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ Gamma Coin!");
            }
        }
        
        // –£–ª—É—á—à–µ–Ω–∏–µ –∑–¥–∞–Ω–∏—è
        function upgradeBuilding(type) {
            const building = buildingsData[type];
            const currentLevel = gameState.buildings[type].level;
            
            if (currentLevel >= 5) {
                showNotification("–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç!");
                return;
            }
            
            const nextLevel = currentLevel + 1;
            const nextLevelData = building.levels[nextLevel];
            
            if (gameState.balance.gamma >= nextLevelData.price) {
                gameState.balance.gamma -= nextLevelData.price;
                gameState.buildings[type].level = nextLevel;
                
                updateBalance();
                showSection('shop');
                showNotification(`–£–ª—É—á—à–µ–Ω–æ: ${building.name} –¥–æ —É—Ä. ${nextLevel}`);
                
                if (navigator.vibrate) navigator.vibrate(50);
            } else {
                showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ Gamma Coin –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è!");
            }
        }
        
        // –ü–æ–∫—É–ø–∫–∞ –ø—Ä–µ–º–∏—É–º–∞
        function buyPremium(type) {
            let price = 0;
            let successMessage = "";
            
            if (type === 'monthly') {
                price = 5;
                successMessage = "Premium –Ω–∞ –º–µ—Å—è—Ü –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!";
            } else if (type === 'lifetime') {
                price = 30;
                successMessage = "Premium –Ω–∞–≤—Å–µ–≥–¥–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!";
            }
            
            if (gameState.balance.ton >= price) {
                gameState.balance.ton -= price;
                gameState.premium.active = true;
                gameState.premium.type = type;
                
                if (type === 'monthly') {
                    const expiryDate = new Date();
                    expiryDate.setMonth(expiryDate.getMonth() + 1);
                    gameState.premium.expiry = expiryDate.getTime();
                }
                
                updateBalance();
                document.getElementById('premium-modal').style.display = 'none';
                showNotification(successMessage);
                
                if (navigator.vibrate) navigator.vibrate(100);
            } else {
                showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ TON!");
            }
        }
        
        // –û–±–º–µ–Ω –≤–∞–ª—é—Ç
        function exchangeCurrency(from, to, amount) {
            let rate = 0;
            let fromBalance = 0;
            let toBalance = 0;
            
            if (from === 'energy' && to === 'gamma') {
                rate = 1 / exchangeRates.energyToGamma;
                fromBalance = 'energy';
                toBalance = 'gamma';
            } else if (from === 'gamma' && to === 'ton') {
                rate = 1 / exchangeRates.gammaToTon;
                fromBalance = 'gamma';
                toBalance = 'ton';
            } else if (from === 'ton' && to === 'gamma') {
                rate = exchangeRates.tonToGamma;
                fromBalance = 'ton';
                toBalance = 'gamma';
            }
            
            if (gameState.balance[fromBalance] >= amount) {
                gameState.balance[fromBalance] -= amount;
                gameState.balance[toBalance] += amount * rate;
                
                updateBalance();
                showNotification(`–û–±–º–µ–Ω–µ–Ω–æ: ${amount} ${from} ‚Üí ${amount * rate} ${to}`);
            } else {
                showNotification(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ${from}!`);
            }
        }
        
        // –†—É–ª–µ—Ç–∫–∞ —ç–Ω–µ—Ä–≥–∏–∏
        function spinEnergyWheel() {
            const now = Date.now();
            const lastSpin = gameState.lastEnergySpin;
            const cooldown = 24 * 60 * 60 * 1000; // 24 —á–∞—Å–∞
            
            if (now - lastSpin < cooldown) {
                const remaining = cooldown - (now - lastSpin);
                const hours = Math.floor(remaining / (60 * 60 * 1000));
                const minutes = Math.floor((remaining % (60 * 60 * 1000)) / (60 * 1000));
                showNotification(`–ü–æ–¥–æ–∂–¥–∏—Ç–µ –µ—â–µ ${hours}—á ${minutes}–º –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ –≤—Ä–∞—â–µ–Ω–∏—è!`);
                return;
            }
            
            const reward = Math.floor(Math.random() * 1901) + 100; // 100-2000
            gameState.balance.energy += reward;
            gameState.lastEnergySpin = now;
            
            updateBalance();
            document.getElementById('energy-wheel-result').textContent = `–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏: ${reward} ‚ö°`;
            showNotification(`–†—É–ª–µ—Ç–∫–∞: +${reward} ‚ö°`);
            
            if (navigator.vibrate) navigator.vibrate(200);
        }
        
        // –†—É–ª–µ—Ç–∫–∞ —É–¥–∞—á–∏
        function spinLuckWheel() {
            if (gameState.balance.ton < 1) {
                showNotification("–ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 1 TON –¥–ª—è –≤—Ä–∞—â–µ–Ω–∏—è!");
                return;
            }
            
            gameState.balance.ton -= 1;
            const reward = (Math.floor(Math.random() * 46) + 5) / 10; // 0.5-5.0
            gameState.balance.ton += reward;
            
            updateBalance();
            document.getElementById('luck-wheel-result').textContent = `–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏: ${reward.toFixed(1)} üíé`;
            showNotification(`–†—É–ª–µ—Ç–∫–∞: ${reward.toFixed(1)} TON`);
            
            if (navigator.vibrate) navigator.vibrate(200);
        }
        
        // –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ (–∏–º–∏—Ç–∞—Ü–∏—è)
        function depositTon(amount) {
            if (amount < 1 || amount > 100) {
                showNotification("–°—É–º–º–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç 1 –¥–æ 100 TON");
                return;
            }
            
            gameState.balance.ton += amount;
            gameState.depositHistory.push({
                amount: amount,
                date: new Date().toISOString()
            });
            
            updateBalance();
            showNotification(`–ü–æ–ø–æ–ª–Ω–µ–Ω–æ: ${amount} TON`);
        }
        
        // –í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤ (–∏–º–∏—Ç–∞—Ü–∏—è)
        function withdrawTon(amount) {
            if (gameState.depositHistory.length === 0) {
                showNotification("–ù—É–∂–Ω–æ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–ª—è –≤—ã–≤–æ–¥–∞");
                return;
            }
            
            const firstDepositDate = new Date(gameState.depositHistory[0].date);
            const now = new Date();
            const daysPassed = (now - firstDepositDate) / (1000 * 60 * 60 * 24);
            
            if (daysPassed < 100) {
                const remaining = Math.ceil(100 - daysPassed);
                showNotification(`–í—ã–≤–æ–¥ –≤–æ–∑–º–æ–∂–µ–Ω —á–µ—Ä–µ–∑ ${remaining} –¥–Ω–µ–π`);
                return;
            }
            
            if (gameState.balance.ton < amount) {
                showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ TON –¥–ª—è –≤—ã–≤–æ–¥–∞");
                return;
            }
            
            gameState.balance.ton -= amount;
            gameState.withdrawHistory.push({
                amount: amount,
                date: new Date().toISOString()
            });
            
            updateBalance();
            showNotification(`–í—ã–≤–µ–¥–µ–Ω–æ: ${amount} TON`);
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–º–∏—É–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        function showPremiumModal() {
            document.getElementById('premium-modal').style.display = 'flex';
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –º–∞–≥–∞–∑–∏–Ω
        function showShop() {
            calculateIncome();
            updateBalance();
            
            let shopHTML = '<h2>üõí –ú–∞–≥–∞–∑–∏–Ω –∑–¥–∞–Ω–∏–π</h2>';
            shopHTML += '<p>–ü–æ–∫—É–ø–∞–π—Ç–µ –∑–¥–∞–Ω–∏—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∫–∞ —ç–Ω–µ—Ä–≥–∏–∏</p>';
            
            for (const [key, building] of Object.entries(buildingsData)) {
                const currentLevel = gameState.buildings[key].level;
                const levelData = building.levels[currentLevel];
                const canAfford = gameState.balance.gamma >= levelData.price;
                const isPremiumLocked = building.premium && !gameState.premium.active;
                
                shopHTML += `
                <div class="building">
                    <div class="building-header">
                        <span class="building-name">${building.emoji} ${building.name}
                            ${building.premium ? '<span class="premium-badge">PREMIUM</span>' : ''}
                        </span>
                        <span class="building-price">${levelData.price} Œì</span>
                    </div>
                    <div class="building-income">–î–æ—Ö–æ–¥: ${levelData.income} ‚ö°/—á–∞—Å (–£—Ä. ${currentLevel})</div>
                    
                    <div class="building-level">
                        <button class="level-btn ${currentLevel === 1 ? 'active' : ''}">1</button>
                        <button class="level-btn ${currentLevel === 2 ? 'active' : ''}">2</button>
                        <button class="level-btn ${currentLevel === 3 ? 'active' : ''}">3</button>
                        <button class="level-btn ${currentLevel === 4 ? 'active' : ''}">4</button>
                        <button class="level-btn ${currentLevel === 5 ? 'active' : ''}">5</button>
                    </div>
                    
                    <button class="buy-btn" 
                            onclick="buyBuilding('${key}')" 
                            ${!canAfford || isPremiumLocked ? 'disabled' : ''}>
                        –ö—É–ø–∏—Ç—å (${levelData.price} Œì)
                    </button>
                    
                    ${currentLevel < 5 ? `
                    <button class="buy-btn" 
                            onclick="upgradeBuilding('${key}')" 
                            style="margin-top: 10px; background: linear-gradient(135deg, #9b59b6, #8e44ad);">
                        –£–ª—É—á—à–∏—Ç—å –¥–æ —É—Ä. ${currentLevel + 1} (${building.levels[currentLevel + 1].price} Œì)
                    </button>
                    ` : ''}
                </div>
                `;
            }
            
            document.getElementById('content-title').textContent = '–ú–∞–≥–∞–∑–∏–Ω';
            document.getElementById('content-text').innerHTML = shopHTML;
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –≥–æ—Ä–æ–¥
        function showCity() {
            calculateIncome();
            updateBalance();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–µ—Ç–∫—É –≥–æ—Ä–æ–¥–∞
            let cityGridHTML = '';
            const totalBuildings = Object.values(gameState.buildings).reduce((sum, b) => sum + b.count, 0);
            
            if (totalBuildings === 0) {
                cityGridHTML = '<p style="grid-column: 1 / -1; text-align: center;">–ü–æ–∫–∞ –Ω–µ—Ç –∑–¥–∞–Ω–∏–π. –ö—É–ø–∏—Ç–µ –∏—Ö –≤ –º–∞–≥–∞–∑–∏–Ω–µ!</p>';
            } else {
                for (let i = 0; i < 9; i++) {
                    let cellContent = '';
                    let buildingType = '';
                    
                    // –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º –∑–¥–∞–Ω–∏—è –ø–æ –∫–ª–µ—Ç–∫–∞–º
                    if (i < gameState.buildings.solar.count) {
                        cellContent = buildingsData.solar.emoji;
                        buildingType = 'solar';
                    } else if (i < gameState.buildings.solar.count + gameState.buildings.wind.count) {
                        cellContent = buildingsData.wind.emoji;
                        buildingType = 'wind';
                    } else if (i < gameState.buildings.solar.count + gameState.buildings.wind.count + gameState.buildings.water.count) {
                        cellContent = buildingsData.water.emoji;
                        buildingType = 'water';
                    } else if (i < gameState.buildings.solar.count + gameState.buildings.wind.count + gameState.buildings.water.count + gameState.buildings.nuclear.count) {
                        cellContent = buildingsData.nuclear.emoji;
                        buildingType = 'nuclear';
                    }
                    
                    if (buildingType) {
                        const level = gameState.buildings[buildingType].level;
                        cityGridHTML += `<div class="city-cell" title="${buildingsData[buildingType].name} (–£—Ä. ${level})">${cellContent}<small style="font-size: 10px;">${level}</small></div>`;
                    } else {
                        cityGridHTML += '<div class="city-cell"></div>';
                    }
                }
            }
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≥–æ—Ä–æ–¥–∞
            let totalIncome = 0;
            let buildingsList = '';
            
            for (const [type, building] of Object.entries(gameState.buildings)) {
                if (building.count > 0 && buildingsData[type]) {
                    const levelData = buildingsData[type].levels[building.level];
                    const buildingIncome = building.count * levelData.income;
                    totalIncome += buildingIncome;
                    
                    buildingsList += `
                        <div style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                            <strong>${buildingsData[type].emoji} ${buildingsData[type].name}:</strong> 
                            ${building.count} —à—Ç. (–£—Ä. ${building.level})<br>
                            <small>–î–æ—Ö–æ–¥: ${buildingIncome} ‚ö°/—á–∞—Å</small>
                        </div>
                    `;
                }
            }
            
            if (buildingsList === '') {
                buildingsList = '<p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–¥–∞–Ω–∏–π. –ü–æ—Å–µ—Ç–∏—Ç–µ –º–∞–≥–∞–∑–∏–Ω!</p>';
            } else {
                buildingsList += `<p style="margin-top: 15px;"><strong>–û–±—â–∏–π –¥–æ—Ö–æ–¥:</strong> ${totalIncome} ‚ö°/—á–∞—Å</p>`;
            }
            
            document.getElementById('content-title').textContent = 'üèôÔ∏è –í–∞—à –≥–æ—Ä–æ–¥';
            document.getElementById('city-grid').innerHTML = cityGridHTML;
            document.getElementById('city-stats').innerHTML = buildingsList;
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Ä—É–ª–µ—Ç–∫—É —ç–Ω–µ—Ä–≥–∏–∏
        function showEnergyWheel() {
            const now = Date.now();
            const lastSpin = gameState.lastEnergySpin;
            const cooldown = 24 * 60 * 60 * 1000; // 24 —á–∞—Å–∞
            let cooldownText = '';
            
            if (now - lastSpin < cooldown) {
                const remaining = cooldown - (now - lastSpin);
                const hours = Math.floor(remaining / (60 * 60 * 1000));
                const minutes = Math.floor((remaining % (60 * 60 * 1000)) / (60 * 1000));
                cooldownText = `<p>–°–ª–µ–¥—É—é—â–µ–µ –≤—Ä–∞—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑: ${hours}—á ${minutes}–º</p>`;
            }
            
            const wheelHTML = `
                <div class="wheel-container">
                    <h2>‚ö° –†—É–ª–µ—Ç–∫–∞ —ç–Ω–µ—Ä–≥–∏–∏</h2>
                    <p>–ö—Ä—É—Ç–∏—Ç–µ —Ä–∞–∑ –≤ 24 —á–∞—Å–∞ –∏ –ø–æ–ª—É—á–∞–π—Ç–µ –æ—Ç 100 –¥–æ 2000 —ç–Ω–µ—Ä–≥–∏–∏!</p>
                    ${cooldownText}
                    <div class="wheel-result" id="energy-wheel-result"></div>
                    <button class="spin-btn" onclick="spinEnergyWheel()">–ö—Ä—É—Ç–∏—Ç—å</button>
                </div>
            `;
            
            document.getElementById('content-title').textContent = '‚ö° –†—É–ª–µ—Ç–∫–∞ —ç–Ω–µ—Ä–≥–∏–∏';
            document.getElementById('content-text').innerHTML = wheelHTML;
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Ä—É–ª–µ—Ç–∫—É —É–¥–∞—á–∏
        function showLuckWheel() {
            const wheelHTML = `
                <div class="wheel-container">
                    <h2>üçÄ –†—É–ª–µ—Ç–∫–∞ —É–¥–∞—á–∏</h2>
                    <p>–ö—Ä—É—Ç–∏—Ç–µ –∑–∞ 1 TON –∏ –ø–æ–ª—É—á–∞–π—Ç–µ –æ—Ç 0.5 –¥–æ 5 TON!</p>
                    <div class="wheel-result" id="luck-wheel-result"></div>
                    <button class="spin-btn" onclick="spinLuckWheel()">–ö—Ä—É—Ç–∏—Ç—å (1 üíé)</button>
                </div>
            `;
            
            document.getElementById('content-title').textContent = 'üçÄ –†—É–ª–µ—Ç–∫–∞ —É–¥–∞—á–∏';
            document.getElementById('content-text').innerHTML = wheelHTML;
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –æ–±–º–µ–Ω
        function showExchange() {
            calculateIncome();
            updateBalance();
            
            const exchangeHTML = `
                <h2>üí± –û–±–º–µ–Ω –≤–∞–ª—é—Ç</h2>
                <p>–û–±–º–µ–Ω–∏–≤–∞–π—Ç–µ –æ–¥–Ω—É –≤–∞–ª—é—Ç—É –Ω–∞ –¥—Ä—É–≥—É—é</p>
                
                <div class="exchange-form">
                    <h3>–û–±–º–µ–Ω—è—Ç—å</h3>
                    <input type="number" id="exchange-amount" class="exchange-input" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ">
                    <select id="exchange-from" class="exchange-input">
                        <option value="energy">‚ö° –≠–Ω–µ—Ä–≥–∏—è</option>
                        <option value="gamma">Œì Gamma Coin</option>
                        <option value="ton">üíé TON</option>
                    </select>
                    <p>‚Üí</p>
                    <select id="exchange-to" class="exchange-input">
                        <option value="gamma">Œì Gamma Coin</option>
                        <option value="ton">üíé TON</option>
                        <option value="energy">‚ö° –≠–Ω–µ—Ä–≥–∏—è</option>
                    </select>
                    <button class="exchange-btn" onclick="processExchange()">–û–±–º–µ–Ω—è—Ç—å</button>
                </div>
                
                <div class="exchange-form" style="margin-top: 30px;">
                    <h3>–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞</h3>
                    <input type="number" id="deposit-amount" class="exchange-input" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ TON (1-100)">
                    <button class="exchange-btn" onclick="processDeposit()" style="background: linear-gradient(135deg, #2ecc71, #27ae60);">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
                </div>
                
                <div class="exchange-form" style="margin-top: 30px;">
                    <h3>–í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤</h3>
                    <input type="number" id="withdraw-amount" class="exchange-input" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ TON">
                    <button class="exchange-btn" onclick="processWithdraw()" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">–í—ã–≤–µ—Å—Ç–∏</button>
                    <p class="withdraw-info">–í—ã–≤–æ–¥ –≤–æ–∑–º–æ–∂–µ–Ω —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ 100 –¥–Ω–µ–π –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è</p>
                </div>
            `;
            
            document.getElementById('content-title').textContent = 'üí± –û–±–º–µ–Ω';
            document.getElementById('content-text').innerHTML = exchangeHTML;
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±–º–µ–Ω–∞
        function processExchange() {
            const from = document.getElementById('exchange-from').value;
            const to = document.getElementById('exchange-to').value;
            const amount = parseFloat(document.getElementById('exchange-amount').value);
            
            if (isNaN(amount) {
                showNotification("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ");
                return;
            }
            
            if (from === to) {
                showNotification("–ù–µ–ª—å–∑—è –æ–±–º–µ–Ω–∏–≤–∞—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –≤–∞–ª—é—Ç—ã");
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –æ–±–º–µ–Ω–∞
            if ((from === 'energy' && to === 'gamma') ||
                (from === 'gamma' && to === 'ton') ||
                (from === 'ton' && to === 'gamma')) {
                exchangeCurrency(from, to, amount);
            } else {
                showNotification("–¢–∞–∫–æ–π –æ–±–º–µ–Ω –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω");
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è
        function processDeposit() {
            const amount = parseFloat(document.getElementById('deposit-amount').value);
            depositTon(amount);
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–≤–æ–¥–∞
        function processWithdraw() {
            const amount = parseFloat(document.getElementById('withdraw-amount').value);
            withdrawTon(amount);
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ä–∞–∑–¥–µ–ª
        function showSection(section) {
            // –£–¥–∞–ª—è–µ–º –∫–ª–∞—Å—Å active —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('.nav-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å active –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–Ω–æ–ø–∫–µ (–µ—Å–ª–∏ —ç—Ç–æ –Ω–µ —Ä—É–ª–µ—Ç–∫–∞)
            if (section !== 'energy-wheel' && section !== 'luck-wheel') {
                document.getElementById(`${section}-btn`).classList.add('active');
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞
            switch(section) {
                case 'events':
                    document.getElementById('content-title').textContent = 'üé≤ –ò–≤–µ–Ω—Ç—ã';
                    document.getElementById('content-text').innerHTML = `
                        <h3>–¢–µ–∫—É—â–∏–µ —Å–æ–±—ã—Ç–∏—è</h3>
                        <div style="background: #fff8e1; padding: 15px; border-radius: 10px; margin: 10px 0;">
                            <strong>–ù–æ–≤—ã—Ö –∏–≤–µ–Ω—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</strong>
                            <p>–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ä–µ–≥—É–ª—è—Ä–Ω–æ, —á—Ç–æ–±—ã –Ω–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –±–æ–Ω—É—Å—ã!</p>
                        </div>
                    `;
                    break;
                    
                case 'shop':
                    showShop();
                    break;
                    
                case 'city':
                    showCity();
                    break;
                    
                case 'leaderboard':
                    document.getElementById('content-title').textContent = 'üèÜ –õ–∏–¥–µ—Ä–±–æ—Ä–¥';
                    document.getElementById('content-text').innerHTML = `
                        <h3>–¢–æ–ø-5 –∏–≥—Ä–æ–∫–æ–≤</h3>
                        <ol style="padding-left: 20px;">
                            <li>–ò–≥—Ä–æ–∫1 - 1,250,000 ‚ö°</li>
                            <li>–ò–≥—Ä–æ–∫2 - 1,100,000 ‚ö°</li>
                            <li>–ò–≥—Ä–æ–∫3 - 900,000 ‚ö°</li>
                            <li>–ò–≥—Ä–æ–∫4 - 750,000 ‚ö°</li>
                            <li>–ò–≥—Ä–æ–∫5 - 500,000 ‚ö°</li>
                        </ol>
                        <p style="margin-top: 15px; color: #3498db;">
                            <strong>–í–∞—à–∞ –ø–æ–∑–∏—Ü–∏—è:</strong> 15 –º–µ—Å—Ç–æ
                        </p>
                    `;
                    break;
                    
                case 'exchange':
                    showExchange();
                    break;
                    
                case 'energy-wheel':
                    showEnergyWheel();
                    break;
                    
                case 'luck-wheel':
                    showLuckWheel();
                    break;
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π
            const savedState = localStorage.getItem('energyEmpireSave');
            if (savedState) {
                try {
                    const parsed = JSON.parse(savedState);
                    gameState = {
                        ...gameState,
                        ...parsed,
                        lastUpdate: Date.now() // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
                    };
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–µ–º–∏—É–º–∞
                    if (gameState.premium.type === 'monthly' && gameState.premium.expiry < Date.now()) {
                        gameState.premium.active = false;
                        gameState.premium.type = null;
                        gameState.premium.expiry = null;
                    }
                } catch (e) {
                    console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è", e);
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–µ–º–∏—É–º —Å—Ç–∞—Ç—É—Å–∞ –∏–∑ Telegram
            if (tg.initDataUnsafe?.user?.is_premium) {
                gameState.premium.active = true;
                gameState.premium.type = 'telegram';
            }
            
            updateBalance();
            showSection('city');
            
            // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            setInterval(() => {
                calculateIncome();
                localStorage.setItem('energyEmpireSave', JSON.stringify(gameState));
            }, 30000);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
            setInterval(() => {
                calculateIncome();
                updateBalance();
            }, 1000);
        }
        
        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
