<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Energy Empire</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
            transition: all 0.3s ease;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 100%;
            padding: 10px;
            position: relative;
            min-height: 100vh;
            padding-bottom: 80px;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            position: relative;
        }
        
        .currency-display {
            display: flex;
            flex-direction: column;
            gap: 5px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .currency-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .round-button {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #6e8efb, #a777e3);
            color: white;
            font-size: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            border: none;
            outline: none;
            transition: transform 0.2s;
        }
        
        .round-button:active {
            transform: scale(0.95);
        }
        
        .main-screen {
            margin-top: 20px;
            background: white;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            min-height: 300px;
            position: relative;
            overflow: hidden;
        }
        
        .nav-buttons {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-around;
            padding: 10px;
            background: white;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }
        
        .nav-button {
            padding: 10px 15px;
            border-radius: 20px;
            background: linear-gradient(135deg, #6e8efb, #a777e3);
            color: white;
            border: none;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
            flex: 1;
            margin: 0 5px;
            text-align: center;
            max-width: 20%;
        }
        
        .nav-button:active {
            transform: scale(0.95);
        }
        
        .nav-button.city {
            flex: 1.5;
            max-width: 30%;
        }
        
        .building {
            display: flex;
            align-items: center;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .building-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            background: #ddd;
            margin-right: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
        }
        
        .building-info {
            flex: 1;
        }
        
        .building-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .building-stats {
            font-size: 12px;
            color: #666;
        }
        
        .building-actions {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .action-button {
            padding: 5px 10px;
            border-radius: 5px;
            border: none;
            background: #6e8efb;
            color: white;
            font-size: 12px;
            cursor: pointer;
        }
        
        .action-button.upgrade {
            background: #4CAF50;
        }
        
        .action-button.buy {
            background: #FF9800;
        }
        
        .premium-badge {
            background: gold;
            color: black;
            padding: 2px 5px;
            border-radius: 5px;
            font-size: 10px;
            font-weight: bold;
            margin-left: 5px;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        
        .modal.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 15px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            transform: translateY(20px);
            transition: transform 0.3s;
        }
        
        .modal.active .modal-content {
            transform: translateY(0);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: bold;
        }
        
        .close-button {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
        }
        
        .roulette-container {
            text-align: center;
            padding: 20px;
        }
        
        .roulette-wheel {
            width: 200px;
            height: 200px;
            margin: 20px auto;
            border-radius: 50%;
            background: conic-gradient(
                red, orange, yellow, green, blue, indigo, violet
            );
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }
        
        .roulette-center {
            width: 30px;
            height: 30px;
            background: white;
            border-radius: 50%;
            position: absolute;
            z-index: 2;
        }
        
        .roulette-pointer {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 20px solid red;
            z-index: 3;
        }
        
        .spin-button {
            padding: 10px 20px;
            background: #FF5722;
            color: white;
            border: none;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
        }
        
        .leaderboard {
            width: 100%;
            border-collapse: collapse;
        }
        
        .leaderboard th, .leaderboard td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .leaderboard th {
            background: #f2f2f2;
        }
        
        .leaderboard tr:nth-child(even) {
            background: #f9f9f9;
        }
        
        .leaderboard tr:hover {
            background: #f1f1f1;
        }
        
        .user-rank {
            font-weight: bold;
            color: #6e8efb;
        }
        
        .exchange-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .exchange-input {
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        
        .exchange-button {
            padding: 10px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .premium-option {
            padding: 15px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border-radius: 10px;
            margin-bottom: 10px;
            color: black;
        }
        
        .premium-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .premium-price {
            font-size: 14px;
        }
        
        .buy-premium {
            padding: 5px 10px;
            background: black;
            color: gold;
            border: none;
            border-radius: 5px;
            margin-top: 5px;
            cursor: pointer;
        }
        
        .city-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        
        .city-building {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 10px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .city-building-icon {
            width: 50px;
            height: 50px;
            margin: 0 auto 5px;
            border-radius: 10px;
            background: #ddd;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
        }
        
        .city-building-name {
            font-weight: bold;
            font-size: 12px;
        }
        
        .city-building-count {
            font-size: 10px;
            color: #666;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .notification.show {
            opacity: 1;
        }
        
        .withdraw-info {
            font-size: 12px;
            color: #666;
            margin-top: 10px;
        }
        
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); }
            to { transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s forwards;
        }
        
        .slide-up {
            animation: slideUp 0.3s forwards;
        }
        
        .pulse {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="currency-display">
                <div class="currency-item">
                    <span>‚ö°</span>
                    <span id="energy-balance">0</span>
                </div>
                <div class="currency-item">
                    <span>Œì</span>
                    <span id="gamma-balance">0</span>
                </div>
                <div class="currency-item">
                    <span>üíé</span>
                    <span id="ton-balance">0</span>
                </div>
            </div>
            
            <button class="round-button" id="premium-button">üëë</button>
            <button class="round-button" id="luck-roulette-button">üçÄ</button>
            <button class="round-button" id="energy-roulette-button">üé°</button>
        </div>
        
        <div class="main-screen" id="main-screen">
            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –º–µ–Ω—è—Ç—å—Å—è -->
            <div class="city-grid" id="city-view">
                <!-- –ó–¥–∞–Ω–∏—è –≥–æ—Ä–æ–¥–∞ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
            </div>
        </div>
        
        <div class="nav-buttons">
            <button class="nav-button" id="events-button">–ò–≤–µ–Ω—Ç—ã</button>
            <button class="nav-button" id="shop-button">–ú–∞–≥–∞–∑–∏–Ω</button>
            <button class="nav-button city" id="city-button">–ì–æ—Ä–æ–¥</button>
            <button class="nav-button" id="leaderboard-button">–¢–æ–ø</button>
            <button class="nav-button" id="exchange-button">–û–±–º–µ–Ω</button>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div class="modal" id="shop-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">–ú–∞–≥–∞–∑–∏–Ω</div>
                <button class="close-button" id="close-shop">&times;</button>
            </div>
            <div id="shop-items">
                <!-- –¢–æ–≤–∞—Ä—ã –º–∞–≥–∞–∑–∏–Ω–∞ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
            </div>
        </div>
    </div>
    
    <div class="modal" id="events-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">–ò–≤–µ–Ω—Ç—ã</div>
                <button class="close-button" id="close-events">&times;</button>
            </div>
            <p>–°–∫–æ—Ä–æ –ø–æ—è–≤—è—Ç—Å—è –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –∏–≤–µ–Ω—Ç—ã!</p>
        </div>
    </div>
    
    <div class="modal" id="leaderboard-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">–¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤</div>
                <button class="close-button" id="close-leaderboard">&times;</button>
            </div>
            <table class="leaderboard">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>–ò–≥—Ä–æ–∫</th>
                        <th>–≠–Ω–µ—Ä–≥–∏—è</th>
                        <th>Gamma</th>
                        <th>TON</th>
                    </tr>
                </thead>
                <tbody id="leaderboard-body">
                    <!-- –î–∞–Ω–Ω—ã–µ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                </tbody>
            </table>
        </div>
    </div>
    
    <div class="modal" id="exchange-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">–û–±–º–µ–Ω</div>
                <button class="close-button" id="close-exchange">&times;</button>
            </div>
            <div class="exchange-tabs">
                <button class="exchange-tab active" data-tab="convert">–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è</button>
                <button class="exchange-tab" data-tab="deposit">–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</button>
                <button class="exchange-tab" data-tab="withdraw">–í—ã–≤–æ–¥</button>
            </div>
            
            <div class="exchange-tab-content active" id="convert-tab">
                <div class="exchange-form">
                    <select class="exchange-input" id="exchange-from">
                        <option value="energy">‚ö° –≠–Ω–µ—Ä–≥–∏—è</option>
                        <option value="gamma">Œì Gamma</option>
                        <option value="ton">üíé TON</option>
                    </select>
                    <input type="number" class="exchange-input" id="exchange-amount" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ">
                    <select class="exchange-input" id="exchange-to">
                        <option value="gamma">Œì Gamma</option>
                        <option value="ton">üíé TON</option>
                        <option value="energy">‚ö° –≠–Ω–µ—Ä–≥–∏—è</option>
                    </select>
                    <button class="exchange-button" id="exchange-submit">–û–±–º–µ–Ω—è—Ç—å</button>
                </div>
            </div>
            
            <div class="exchange-tab-content" id="deposit-tab">
                <div class="exchange-form">
                    <input type="number" class="exchange-input" id="deposit-amount" placeholder="TON (1-100)" min="1" max="100">
                    <button class="exchange-button" id="deposit-submit">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
                    <p>–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ç 1 –¥–æ 100 TON</p>
                </div>
            </div>
            
            <div class="exchange-tab-content" id="withdraw-tab">
                <div class="exchange-form">
                    <input type="number" class="exchange-input" id="withdraw-amount" placeholder="TON">
                    <input type="text" class="exchange-input" id="withdraw-address" placeholder="TON –∫–æ—à–µ–ª–µ–∫">
                    <button class="exchange-button" id="withdraw-submit">–í—ã–≤–µ—Å—Ç–∏</button>
                    <p class="withdraw-info">–í—ã–≤–æ–¥ –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ 100 –¥–Ω–µ–π –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏. –ö–æ–º–∏—Å—Å–∏—è: 5%</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal" id="energy-roulette-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">–†—É–ª–µ—Ç–∫–∞ —ç–Ω–µ—Ä–≥–∏–∏</div>
                <button class="close-button" id="close-energy-roulette">&times;</button>
            </div>
            <div class="roulette-container">
                <div class="roulette-wheel" id="energy-wheel">
                    <div class="roulette-center"></div>
                    <div class="roulette-pointer"></div>
                </div>
                <button class="spin-button" id="spin-energy">–ö—Ä—É—Ç–∏—Ç—å (1 —Ä–∞–∑ –≤ –¥–µ–Ω—å)</button>
                <p id="energy-roulette-result"></p>
            </div>
        </div>
    </div>
    
    <div class="modal" id="luck-roulette-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">–†—É–ª–µ—Ç–∫–∞ —É–¥–∞—á–∏</div>
                <button class="close-button" id="close-luck-roulette">&times;</button>
            </div>
            <div class="roulette-container">
                <div class="roulette-wheel" id="luck-wheel">
                    <div class="roulette-center"></div>
                    <div class="roulette-pointer"></div>
                </div>
                <button class="spin-button" id="spin-luck">–ö—Ä—É—Ç–∏—Ç—å (1 TON)</button>
                <p id="luck-roulette-result"></p>
            </div>
        </div>
    </div>
    
    <div class="modal" id="premium-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">–ü—Ä–µ–º–∏—É–º —Å—Ç–∞—Ç—É—Å</div>
                <button class="close-button" id="close-premium">&times;</button>
            </div>
            <div class="premium-option">
                <div class="premium-title">–ü—Ä–µ–º–∏—É–º –Ω–∞ 1 –º–µ—Å—è—Ü</div>
                <div class="premium-price">5 üíé TON</div>
                <button class="buy-premium" data-type="monthly">–ö—É–ø–∏—Ç—å</button>
            </div>
            <div class="premium-option">
                <div class="premium-title">–ü—Ä–µ–º–∏—É–º –Ω–∞–≤—Å–µ–≥–¥–∞</div>
                <div class="premium-price">30 üíé TON</div>
                <button class="buy-premium" data-type="lifetime">–ö—É–ø–∏—Ç—å</button>
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification"></div>
    
    <div class="loading" id="loading" style="display: none;">
        <div class="spinner"></div>
    </div>
    
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        // –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        let userData = {
            id: tg.initDataUnsafe.user?.id || Math.floor(Math.random() * 1000000),
            username: tg.initDataUnsafe.user?.username || '–ì–æ—Å—Ç—å',
            firstName: tg.initDataUnsafe.user?.first_name || '–ò–≥—Ä–æ–∫',
            lastName: tg.initDataUnsafe.user?.last_name || '',
            energy: 0,
            gamma: 0,
            ton: 0,
            buildings: {
                solar: { level: 0, count: 0 },
                wind: { level: 0, count: 0 },
                water: { level: 0, count: 0 },
                premium: { level: 0, count: 0 }
            },
            premium: {
                active: false,
                type: null,
                expires: null
            },
            lastEnergyRoulette: null,
            registrationDate: new Date().toISOString(),
            lastEnergyUpdate: new Date().toISOString()
        };
        
        // –¶–µ–Ω—ã –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–¥–∞–Ω–∏–π
        const buildingData = {
            solar: {
                name: "–°–æ–ª–Ω–µ—á–Ω–∞—è –±–∞—Ç–∞—Ä–µ—è",
                buyPrice: [7, 10, 37, 54, 107],
                income: [700, 1000, 2100, 4400, 5700],
                icon: "‚òÄÔ∏è"
            },
            wind: {
                name: "–í–µ—Ç—Ä—è–Ω–∞—è –±–∞—Ç–∞—Ä–µ—è",
                buyPrice: [21, 58, 127, 256, 448],
                income: [2100, 4400, 5700, 9600, 17300],
                icon: "üå¨Ô∏è"
            },
            water: {
                name: "–í–æ–¥–Ω–∞—è –±–∞—Ç–∞—Ä–µ—è",
                buyPrice: [76, 148, 272, 437, 821],
                income: [5700, 9600, 17300, 26700, 48400],
                icon: "üíß"
            },
            premium: {
                name: "–ö–≤–∞–Ω—Ç–æ–≤–∞—è –±–∞—Ç–∞—Ä–µ—è",
                buyPrice: [1000],
                income: [10000],
                icon: "‚öõÔ∏è"
            }
        };
        
        // –ö—É—Ä—Å—ã –æ–±–º–µ–Ω–∞
        const exchangeRates = {
            energyToGamma: 0.001, // 10000 —ç–Ω–µ—Ä–≥–∏–∏ = 10 –≥–∞–º–º–∞
            gammaToTon: 0.0001,   // 10000 –≥–∞–º–º–∞ = 1 —Ç–æ–Ω
            tonToGamma: 10000      // 1 —Ç–æ–Ω = 10000 –≥–∞–º–º–∞
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', async function() {
            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            await loadUserData();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
            updateBalances();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥–æ—Ä–æ–¥–∞
            initCityView();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–∞–≥–∞–∑–∏–Ω–∞
            initShop();
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
            setupEventListeners();
            
            // –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —ç–Ω–µ—Ä–≥–∏–∏
            startEnergyProduction();
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞
            loadLeaderboard();
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–µ–º–∏—É–º —Å—Ç–∞—Ç—É—Å–∞
            checkPremiumStatus();
        });
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function loadUserData() {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É
            const savedData = localStorage.getItem(`userData_${userData.id}`);
            if (savedData) {
                const parsedData = JSON.parse(savedData);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ –ø–æ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ –µ—Å—Ç—å –≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                for (const key in parsedData) {
                    if (userData.hasOwnProperty(key)) {
                        userData[key] = parsedData[key];
                    }
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø—Ä–æ—à–ª–æ –ª–∏ –≤—Ä–µ–º—è —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —ç–Ω–µ—Ä–≥–∏–∏
                const now = new Date();
                const lastUpdate = new Date(userData.lastEnergyUpdate);
                const diffHours = (now - lastUpdate) / (1000 * 60 * 60);
                
                if (diffHours > 0) {
                    // –í—ã—á–∏—Å–ª—è–µ–º –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–Ω—É—é —ç–Ω–µ—Ä–≥–∏—é
                    let producedEnergy = 0;
                    
                    for (const buildingType in userData.buildings) {
                        const building = userData.buildings[buildingType];
                        if (building.count > 0 && building.level > 0) {
                            const income = buildingData[buildingType].income[building.level - 1];
                            producedEnergy += income * building.count * diffHours;
                        }
                    }
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º —ç–Ω–µ—Ä–≥–∏—é –∫ –±–∞–ª–∞–Ω—Å—É
                    userData.energy += Math.floor(producedEnergy);
                    userData.lastEnergyUpdate = now.toISOString();
                    saveUserData();
                }
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function saveUserData() {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É
            localStorage.setItem(`userData_${userData.id}`, JSON.stringify(userData));
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å –Ω–∞ —ç–∫—Ä–∞–Ω–µ
            updateBalances();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ª–∏–¥–µ—Ä–±–æ—Ä–¥
            updateLeaderboard();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
        function updateBalances() {
            document.getElementById('energy-balance').textContent = userData.energy.toLocaleString();
            document.getElementById('gamma-balance').textContent = userData.gamma.toLocaleString();
            document.getElementById('ton-balance').textContent = userData.ton.toLocaleString();
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∏–¥–∞ –≥–æ—Ä–æ–¥–∞
        function initCityView() {
            const cityView = document.getElementById('city-view');
            cityView.innerHTML = '';
            
            for (const buildingType in userData.buildings) {
                const building = userData.buildings[buildingType];
                if (building.count > 0 || buildingType === 'premium') {
                    const buildingInfo = buildingData[buildingType];
                    
                    const buildingElement = document.createElement('div');
                    buildingElement.className = 'city-building';
                    
                    buildingElement.innerHTML = `
                        <div class="city-building-icon">${buildingInfo.icon}</div>
                        <div class="city-building-name">${buildingInfo.name}</div>
                        <div class="city-building-count">–£—Ä–æ–≤–µ–Ω—å ${building.level} √ó ${building.count}</div>
                    `;
                    
                    cityView.appendChild(buildingElement);
                }
            }
            
            if (cityView.children.length === 0) {
                cityView.innerHTML = '<p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–¥–∞–Ω–∏–π. –ü–æ—Å–µ—Ç–∏—Ç–µ –º–∞–≥–∞–∑–∏–Ω, —á—Ç–æ–±—ã –∫—É–ø–∏—Ç—å –ø–µ—Ä–≤—ã–µ –∑–¥–∞–Ω–∏—è!</p>';
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–∞–≥–∞–∑–∏–Ω–∞
        function initShop() {
            const shopItems = document.getElementById('shop-items');
            shopItems.innerHTML = '';
            
            for (const buildingType in buildingData) {
                if (buildingType === 'premium' && !userData.premium.active) continue;
                
                const building = buildingData[buildingType];
                const userBuilding = userData.buildings[buildingType];
                const currentLevel = userBuilding.level;
                const nextLevel = currentLevel + 1;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–Ω–æ –ª–∏ —É–ª—É—á—à–∏—Ç—å –∑–¥–∞–Ω–∏–µ
                const canUpgrade = nextLevel <= building.buyPrice.length;
                const canBuy = userBuilding.count === 0 && currentLevel === 0;
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–µ–Ω—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ, –ø–æ–∫—É–ø–∞–µ–º –∏–ª–∏ —É–ª—É—á—à–∞–µ–º
                let price, actionText;
                if (canBuy) {
                    price = building.buyPrice[0];
                    actionText = '–ö—É–ø–∏—Ç—å';
                } else if (canUpgrade) {
                    price = building.buyPrice[nextLevel - 1];
                    actionText = '–£–ª—É—á—à–∏—Ç—å';
                } else {
                    price = '–ú–∞–∫—Å. —É—Ä.';
                    actionText = '–ú–∞–∫—Å.';
                }
                
                const buildingElement = document.createElement('div');
                buildingElement.className = 'building';
                
                buildingElement.innerHTML = `
                    <div class="building-icon">${building.icon}</div>
                    <div class="building-info">
                        <div class="building-name">${building.name} ${buildingType === 'premium' ? '<span class="premium-badge">PREMIUM</span>' : ''}</div>
                        <div class="building-stats">
                            –î–æ—Ö–æ–¥: ${canUpgrade ? building.income[nextLevel - 1] : building.income[currentLevel - 1]} —ç/—á
                            ${userBuilding.count > 0 ? `| –£—Ä. ${currentLevel} | –ö–æ–ª-–≤–æ: ${userBuilding.count}` : ''}
                        </div>
                    </div>
                    <div class="building-actions">
                        <button class="action-button ${canBuy ? 'buy' : 'upgrade'}" 
                                data-type="${buildingType}" 
                                data-action="${canBuy ? 'buy' : 'upgrade'}"
                                ${(!canBuy && !canUpgrade) || userData.gamma < price ? 'disabled' : ''}>
                            ${actionText} –∑–∞ ${price} Œì
                        </button>
                    </div>
                `;
                
                shopItems.appendChild(buildingElement);
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–Ω–æ–ø–æ–∫ –≤ –º–∞–≥–∞–∑–∏–Ω–µ
            document.querySelectorAll('.building-actions button').forEach(button => {
                button.addEventListener('click', function() {
                    const buildingType = this.getAttribute('data-type');
                    const action = this.getAttribute('data-action');
                    
                    if (action === 'buy') {
                        buyBuilding(buildingType);
                    } else {
                        upgradeBuilding(buildingType);
                    }
                });
            });
        }
        
        // –ü–æ–∫—É–ø–∫–∞ –∑–¥–∞–Ω–∏—è
        function buyBuilding(buildingType) {
            const building = buildingData[buildingType];
            const price = building.buyPrice[0];
            
            if (userData.gamma >= price) {
                userData.gamma -= price;
                userData.buildings[buildingType].count = 1;
                userData.buildings[buildingType].level = 1;
                saveUserData();
                initShop();
                initCityView();
                showNotification(`–í—ã –∫—É–ø–∏–ª–∏ ${building.name}!`);
            } else {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ Gamma Coin!', 'error');
            }
        }
        
        // –£–ª—É—á—à–µ–Ω–∏–µ –∑–¥–∞–Ω–∏—è
        function upgradeBuilding(buildingType) {
            const building = buildingData[buildingType];
            const currentLevel = userData.buildings[buildingType].level;
            const nextLevel = currentLevel + 1;
            
            if (nextLevel > building.buyPrice.length) {
                showNotification('–ó–¥–∞–Ω–∏–µ —É–∂–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è!', 'error');
                return;
            }
            
            const price = building.buyPrice[nextLevel - 1];
            
            if (userData.gamma >= price) {
                userData.gamma -= price;
                userData.buildings[buildingType].level = nextLevel;
                saveUserData();
                initShop();
                initCityView();
                showNotification(`–í—ã —É–ª—É—á—à–∏–ª–∏ ${building.name} –¥–æ —É—Ä–æ–≤–Ω—è ${nextLevel}!`);
            } else {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ Gamma Coin!', 'error');
            }
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            // –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
            document.getElementById('shop-button').addEventListener('click', () => {
                document.getElementById('shop-modal').classList.add('active');
            });
            
            document.getElementById('events-button').addEventListener('click', () => {
                document.getElementById('events-modal').classList.add('active');
            });
            
            document.getElementById('leaderboard-button').addEventListener('click', () => {
                document.getElementById('leaderboard-modal').classList.add('active');
            });
            
            document.getElementById('exchange-button').addEventListener('click', () => {
                document.getElementById('exchange-modal').classList.add('active');
            });
            
            document.getElementById('city-button').addEventListener('click', () => {
                // –£–∂–µ –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ
            });
            
            // –ö–Ω–æ–ø–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
            document.getElementById('close-shop').addEventListener('click', () => {
                document.getElementById('shop-modal').classList.remove('active');
            });
            
            document.getElementById('close-events').addEventListener('click', () => {
                document.getElementById('events-modal').classList.remove('active');
            });
            
            document.getElementById('close-leaderboard').addEventListener('click', () => {
                document.getElementById('leaderboard-modal').classList.remove('active');
            });
            
            document.getElementById('close-exchange').addEventListener('click', () => {
                document.getElementById('exchange-modal').classList.remove('active');
            });
            
            document.getElementById('close-energy-roulette').addEventListener('click', () => {
                document.getElementById('energy-roulette-modal').classList.remove('active');
            });
            
            document.getElementById('close-luck-roulette').addEventListener('click', () => {
                document.getElementById('luck-roulette-modal').classList.remove('active');
            });
            
            document.getElementById('close-premium').addEventListener('click', () => {
                document.getElementById('premium-modal').classList.remove('active');
            });
            
            // –ö—Ä—É–≥–ª—ã–µ –∫–Ω–æ–ø–∫–∏
            document.getElementById('energy-roulette-button').addEventListener('click', () => {
                document.getElementById('energy-roulette-modal').classList.add('active');
            });
            
            document.getElementById('luck-roulette-button').addEventListener('click', () => {
                document.getElementById('luck-roulette-modal').classList.add('active');
            });
            
            document.getElementById('premium-button').addEventListener('click', () => {
                document.getElementById('premium-modal').classList.add('active');
            });
            
            // –†—É–ª–µ—Ç–∫–∞ —ç–Ω–µ—Ä–≥–∏–∏
            document.getElementById('spin-energy').addEventListener('click', spinEnergyRoulette);
            
            // –†—É–ª–µ—Ç–∫–∞ —É–¥–∞—á–∏
            document.getElementById('spin-luck').addEventListener('click', spinLuckRoulette);
            
            // –û–±–º–µ–Ω
            document.getElementById('exchange-submit').addEventListener('click', exchangeCurrency);
            
            // –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
            document.getElementById('deposit-submit').addEventListener('click', depositTon);
            
            // –í—ã–≤–æ–¥
            document.getElementById('withdraw-submit').addEventListener('click', withdrawTon);
            
            // –ü–æ–∫—É–ø–∫–∞ –ø—Ä–µ–º–∏—É–º–∞
            document.querySelectorAll('.buy-premium').forEach(button => {
                button.addEventListener('click', function() {
                    const type = this.getAttribute('data-type');
                    buyPremium(type);
                });
            });
            
            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫ –≤ –æ–±–º–µ–Ω–µ
            document.querySelectorAll('.exchange-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    
                    // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                    document.querySelectorAll('.exchange-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.exchange-tab-content').forEach(c => c.classList.remove('active'));
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Ç–µ–∫—É—â–µ–π –≤–∫–ª–∞–¥–∫–µ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç—É
                    this.classList.add('active');
                    document.getElementById(`${tabName}-tab`).classList.add('active');
                });
            });
        }
        
        // –ó–∞–ø—É—Å–∫ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ —ç–Ω–µ—Ä–≥–∏–∏
        function startEnergyProduction() {
            setInterval(() => {
                let producedEnergy = 0;
                
                for (const buildingType in userData.buildings) {
                    const building = userData.buildings[buildingType];
                    if (building.count > 0 && building.level > 0) {
                        const income = buildingData[buildingType].income[building.level - 1];
                        producedEnergy += income * building.count / 60; // –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ –≤ –º–∏–Ω—É—Ç—É
                    }
                }
                
                if (producedEnergy > 0) {
                    userData.energy += Math.floor(producedEnergy);
                    userData.lastEnergyUpdate = new Date().toISOString();
                    updateBalances();
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
                    if (new Date().getSeconds() === 0) {
                        saveUserData();
                    }
                }
            }, 60000); // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞
        async function loadLeaderboard() {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É
            // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–µ–º —Ñ–∏–∫—Ç–∏–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            const leaderboard = [
                { id: userData.id, username: userData.username, energy: userData.energy, gamma: userData.gamma, ton: userData.ton },
                { id: 2, username: 'Player2', energy: 50000, gamma: 2000, ton: 10 },
                { id: 3, username: 'Player3', energy: 45000, gamma: 1800, ton: 9 },
                { id: 4, username: 'Player4', energy: 40000, gamma: 1500, ton: 8 },
                { id: 5, username: 'Player5', energy: 35000, gamma: 1200, ton: 7 },
                { id: 6, username: 'Player6', energy: 30000, gamma: 1000, ton: 6 },
                { id: 7, username: 'Player7', energy: 25000, gamma: 800, ton: 5 },
                { id: 8, username: 'Player8', energy: 20000, gamma: 600, ton: 4 },
                { id: 9, username: 'Player9', energy: 15000, gamma: 400, ton: 3 },
                { id: 10, username: 'Player10', energy: 10000, gamma: 200, ton: 2 }
            ];
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —ç–Ω–µ—Ä–≥–∏–∏
            leaderboard.sort((a, b) => b.energy - a.energy);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞
            const leaderboardBody = document.getElementById('leaderboard-body');
            leaderboardBody.innerHTML = '';
            
            leaderboard.forEach((player, index) => {
                const row = document.createElement('tr');
                if (player.id === userData.id) {
                    row.classList.add('user-rank');
                }
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${player.username}</td>
                    <td>${player.energy.toLocaleString()}</td>
                    <td>${player.gamma.toLocaleString()}</td>
                    <td>${player.ton.toLocaleString()}</td>
                `;
                
                leaderboardBody.appendChild(row);
            });
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
        async function updateLeaderboard() {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É
            // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –ª–∏–¥–µ—Ä–±–æ—Ä–¥
            loadLeaderboard();
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–µ–º–∏—É–º —Å—Ç–∞—Ç—É—Å–∞
        function checkPremiumStatus() {
            if (userData.premium.active && userData.premium.expires) {
                const now = new Date();
                const expires = new Date(userData.premium.expires);
                
                if (now > expires && userData.premium.type === 'monthly') {
                    userData.premium.active = false;
                    userData.premium.type = null;
                    userData.premium.expires = null;
                    saveUserData();
                    showNotification('–í–∞—à –ø—Ä–µ–º–∏—É–º —Å—Ç–∞—Ç—É—Å –∏—Å—Ç–µ–∫!');
                }
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–µ–º–∏—É–º –∫–Ω–æ–ø–∫–∏
            const premiumButton = document.getElementById('premium-button');
            if (userData.premium.active) {
                premiumButton.classList.add('pulse');
                premiumButton.style.background = 'linear-gradient(135deg, #FFD700, #FFA500)';
            } else {
                premiumButton.classList.remove('pulse');
                premiumButton.style.background = 'linear-gradient(135deg, #6e8efb, #a777e3)';
            }
        }
        
        // –†—É–ª–µ—Ç–∫–∞ —ç–Ω–µ—Ä–≥–∏–∏
        function spinEnergyRoulette() {
            const now = new Date();
            const lastSpin = userData.lastEnergyRoulette ? new Date(userData.lastEnergyRoulette) : null;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–Ω–æ –ª–∏ –∫—Ä—É—Ç–∏—Ç—å —Ä—É–ª–µ—Ç–∫—É
            if (lastSpin && (now - lastSpin) < 24 * 60 * 60 * 1000) {
                const nextSpin = new Date(lastSpin.getTime() + 24 * 60 * 60 * 1000);
                const hoursLeft = Math.floor((nextSpin - now) / (1000 * 60 * 60));
                showNotification(`–í—ã —É–∂–µ –∫—Ä—É—Ç–∏–ª–∏ —Ä—É–ª–µ—Ç–∫—É —Å–µ–≥–æ–¥–Ω—è. –°–ª–µ–¥—É—é—â–∞—è –ø–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ ${hoursLeft} —á–∞—Å–æ–≤.`, 'error');
                return;
            }
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è
            const wheel = document.getElementById('energy-wheel');
            const resultElement = document.getElementById('energy-roulette-result');
            const spinButton = document.getElementById('spin-energy');
            
            spinButton.disabled = true;
            resultElement.textContent = '';
            
            // –í—Ä–∞—â–∞–µ–º –∫–æ–ª–µ—Å–æ
            wheel.style.transition = 'none';
            wheel.style.transform = 'rotate(0deg)';
            
            setTimeout(() => {
                wheel.style.transition = 'transform 3s ease-out';
                
                // –°–ª—É—á–∞–π–Ω—ã–π —É–≥–æ–ª –≤—Ä–∞—â–µ–Ω–∏—è (–æ—Ç 2 –¥–æ 5 –ø–æ–ª–Ω—ã—Ö –æ–±–æ—Ä–æ—Ç–æ–≤ + —Å–ª—É—á–∞–π–Ω—ã–π —Å–µ–∫—Ç–æ—Ä)
                const spins = 2 + Math.floor(Math.random() * 4);
                const sector = Math.floor(Math.random() * 12) * 30; // 12 —Å–µ–∫—Ç–æ—Ä–æ–≤ –ø–æ 30 –≥—Ä–∞–¥—É—Å–æ–≤
                const rotation = spins * 360 + sector;
                
                wheel.style.transform = `rotate(${rotation}deg)`;
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤—ã–∏–≥—Ä—ã—à —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    // –í—ã–∏–≥—Ä—ã—à –æ—Ç 100 –¥–æ 2000 —ç–Ω–µ—Ä–≥–∏–∏
                    const minWin = 100;
                    const maxWin = 2000;
                    const winAmount = Math.floor(Math.random() * (maxWin - minWin + 1)) + minWin;
                    
                    userData.energy += winAmount;
                    userData.lastEnergyRoulette = now.toISOString();
                    saveUserData();
                    
                    resultElement.textContent = `–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${winAmount} ‚ö° —ç–Ω–µ—Ä–≥–∏–∏!`;
                    spinButton.disabled = false;
                    
                    showNotification(`–í—ã –ø–æ–ª—É—á–∏–ª–∏ ${winAmount} ‚ö° —ç–Ω–µ—Ä–≥–∏–∏!`);
                }, 3000);
            }, 10);
        }
        
        // –†—É–ª–µ—Ç–∫–∞ —É–¥–∞—á–∏
        function spinLuckRoulette() {
            if (userData.ton < 1) {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ TON –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ä—É–ª–µ—Ç–∫–∏!', 'error');
                return;
            }
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è
            const wheel = document.getElementById('luck-wheel');
            const resultElement = document.getElementById('luck-roulette-result');
            const spinButton = document.getElementById('spin-luck');
            
            spinButton.disabled = true;
            resultElement.textContent = '';
            
            // –í—Ä–∞—â–∞–µ–º –∫–æ–ª–µ—Å–æ
            wheel.style.transition = 'none';
            wheel.style.transform = 'rotate(0deg)';
            
            setTimeout(() => {
                wheel.style.transition = 'transform 3s ease-out';
                
                // –°–ª—É—á–∞–π–Ω—ã–π —É–≥–æ–ª –≤—Ä–∞—â–µ–Ω–∏—è (–æ—Ç 2 –¥–æ 5 –ø–æ–ª–Ω—ã—Ö –æ–±–æ—Ä–æ—Ç–æ–≤ + —Å–ª—É—á–∞–π–Ω—ã–π —Å–µ–∫—Ç–æ—Ä)
                const spins = 2 + Math.floor(Math.random() * 4);
                const sector = Math.floor(Math.random() * 12) * 30; // 12 —Å–µ–∫—Ç–æ—Ä–æ–≤ –ø–æ 30 –≥—Ä–∞–¥—É—Å–æ–≤
                const rotation = spins * 360 + sector;
                
                wheel.style.transform = `rotate(${rotation}deg)`;
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤—ã–∏–≥—Ä—ã—à —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    // 99% —à–∞–Ω—Å –≤—ã–∏–≥—Ä–∞—Ç—å 0.5-1 TON, 1% —à–∞–Ω—Å –≤—ã–∏–≥—Ä–∞—Ç—å 1-5 TON
                    const isBigWin = Math.random() < 0.01;
                    let winAmount;
                    
                    if (isBigWin) {
                        winAmount = 1 + Math.random() * 4; // 1-5 TON
                    } else {
                        winAmount = 0.5 + Math.random() * 0.5; // 0.5-1 TON
                    }
                    
                    winAmount = parseFloat(winAmount.toFixed(2));
                    
                    // –í—ã—á–∏—Ç–∞–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å –∫—Ä—É—Ç–∫–∏
                    userData.ton -= 1;
                    userData.ton += winAmount;
                    saveUserData();
                    
                    resultElement.textContent = `–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${winAmount} üíé TON!`;
                    spinButton.disabled = false;
                    
                    if (isBigWin) {
                        showNotification(`–û–ì–†–û–ú–ù–´–ô –í–´–ò–ì–†–´–®! –í—ã –ø–æ–ª—É—á–∏–ª–∏ ${winAmount} üíé TON!`, 'success');
                    } else {
                        showNotification(`–í—ã –ø–æ–ª—É—á–∏–ª–∏ ${winAmount} üíé TON!`);
                    }
                }, 3000);
            }, 10);
        }
        
        // –û–±–º–µ–Ω –≤–∞–ª—é—Ç—ã
        function exchangeCurrency() {
            const from = document.getElementById('exchange-from').value;
            const to = document.getElementById('exchange-to').value;
            const amount = parseFloat(document.getElementById('exchange-amount').value);
            
            if (isNaN(amount) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É!', 'error');
                return;
            }
            
            if (amount <= 0) {
                showNotification('–°—É–º–º–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–æ–ª—å—à–µ –Ω—É–ª—è!', 'error');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç—å —Å—Ä–µ–¥—Å—Ç–≤
            if (from === 'energy' && userData.energy < amount) {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏!', 'error');
                return;
            }
            
            if (from === 'gamma' && userData.gamma < amount) {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ Gamma Coin!', 'error');
                return;
            }
            
            if (from === 'ton' && userData.ton < amount) {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ TON!', 'error');
                return;
            }
            
            // –í—ã–ø–æ–ª–Ω—è–µ–º –æ–±–º–µ–Ω
            let result = 0;
            
            if (from === 'energy' && to === 'gamma') {
                result = amount * exchangeRates.energyToGamma;
                userData.energy -= amount;
                userData.gamma += result;
            } 
            else if (from === 'gamma' && to === 'ton') {
                result = amount * exchangeRates.gammaToTon;
                userData.gamma -= amount;
                userData.ton += result;
            }
            else if (from === 'ton' && to === 'gamma') {
                result = amount * exchangeRates.tonToGamma;
                userData.ton -= amount;
                userData.gamma += result;
            }
            else if (from === 'gamma' && to === 'energy') {
                result = amount / exchangeRates.energyToGamma;
                userData.gamma -= amount;
                userData.energy += result;
            }
            else {
                showNotification('–¢–∞–∫–æ–π –æ–±–º–µ–Ω –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω!', 'error');
                return;
            }
            
            saveUserData();
            showNotification(`–û–±–º–µ–Ω —É—Å–ø–µ—à–µ–Ω! –í—ã –ø–æ–ª—É—á–∏–ª–∏ ${result.toFixed(2)} ${to === 'gamma' ? 'Œì' : to === 'ton' ? 'üíé TON' : '‚ö°'}`);
        }
        
        // –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ TON
        function depositTon() {
            const amount = parseFloat(document.getElementById('deposit-amount').value);
            
            if (isNaN(amount)) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É!', 'error');
                return;
            }
            
            if (amount < 1 || amount > 100) {
                showNotification('–°—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç 1 –¥–æ 100 TON!', 'error');
                return;
            }
            
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –≤—ã–∑–æ–≤ –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã Telegram
            showLoading(true);
            
            // –ò–º–∏—Ç–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–∞
            setTimeout(() => {
                showLoading(false);
                
                // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –ø–ª–∞—Ç–µ–∂–∞
                const paymentSuccess = true; // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –≤—Å–µ–≥–¥–∞ —É—Å–ø–µ—Ö
                
                if (paymentSuccess) {
                    userData.ton += amount;
                    saveUserData();
                    showNotification(`–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–∞ ${amount} TON —É—Å–ø–µ—à–Ω–æ!`);
                    
                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                    document.getElementById('exchange-modal').classList.remove('active');
                } else {
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.', 'error');
                }
            }, 2000);
        }
        
        // –í—ã–≤–æ–¥ TON
        function withdrawTon() {
            const amount = parseFloat(document.getElementById('withdraw-amount').value);
            const address = document.getElementById('withdraw-address').value.trim();
            
            if (isNaN(amount)) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É!', 'error');
                return;
            }
            
            if (amount <= 0) {
                showNotification('–°—É–º–º–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–æ–ª—å—à–µ –Ω—É–ª—è!', 'error');
                return;
            }
            
            if (userData.ton < amount) {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ TON –¥–ª—è –≤—ã–≤–æ–¥–∞!', 'error');
                return;
            }
            
            if (!address || address.length < 10) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∞–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞!', 'error');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø—Ä–æ—à–ª–æ –ª–∏ 100 –¥–Ω–µ–π —Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
            const regDate = new Date(userData.registrationDate);
            const now = new Date();
            const daysPassed = (now - regDate) / (1000 * 60 * 60 * 24);
            
            if (daysPassed < 100) {
                const daysLeft = Math.ceil(100 - daysPassed);
                showNotification(`–í—ã–≤–æ–¥ –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ ${daysLeft} –¥–Ω–µ–π –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏!`, 'error');
                return;
            }
            
            // –ö–æ–º–∏—Å—Å–∏—è 5%
            const commission = amount * 0.05;
            const finalAmount = amount - commission;
            
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É –¥–ª—è –≤—ã–≤–æ–¥–∞
            showLoading(true);
            
            setTimeout(() => {
                showLoading(false);
                
                // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –≤—ã–≤–æ–¥–∞
                const withdrawSuccess = true; // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –≤—Å–µ–≥–¥–∞ —É—Å–ø–µ—Ö
                
                if (withdrawSuccess) {
                    userData.ton -= amount;
                    saveUserData();
                    showNotification(`–í—ã–≤–æ–¥ ${finalAmount.toFixed(2)} TON (–∫–æ–º–∏—Å—Å–∏—è 5%) —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –∫–æ—à–µ–ª–µ–∫ ${address}`);
                    
                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                    document.getElementById('exchange-modal').classList.remove('active');
                } else {
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–≤–æ–¥–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.', 'error');
                }
            }, 2000);
        }
        
        // –ü–æ–∫—É–ø–∫–∞ –ø—Ä–µ–º–∏—É–º —Å—Ç–∞—Ç—É—Å–∞
        function buyPremium(type) {
            let price, duration;
            
            if (type === 'monthly') {
                price = 5;
                duration = '1 –º–µ—Å—è—Ü';
            } else if (type === 'lifetime') {
                price = 30;
                duration = '–Ω–∞–≤—Å–µ–≥–¥–∞';
            } else {
                showNotification('–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–∏–ø –ø—Ä–µ–º–∏—É–º —Å—Ç–∞—Ç—É—Å–∞!', 'error');
                return;
            }
            
            if (userData.ton < price) {
                showNotification(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ TON –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –ø—Ä–µ–º–∏—É–º —Å—Ç–∞—Ç—É—Å–∞ (${price} TON)!`, 'error');
                return;
            }
            
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –≤—ã–∑–æ–≤ –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã Telegram
            showLoading(true);
            
            setTimeout(() => {
                showLoading(false);
                
                // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –ø–ª–∞—Ç–µ–∂–∞
                const paymentSuccess = true; // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –≤—Å–µ–≥–¥–∞ —É—Å–ø–µ—Ö
                
                if (paymentSuccess) {
                    userData.ton -= price;
                    userData.premium.active = true;
                    userData.premium.type = type;
                    
                    if (type === 'monthly') {
                        const expires = new Date();
                        expires.setMonth(expires.getMonth() + 1);
                        userData.premium.expires = expires.toISOString();
                    } else {
                        userData.premium.expires = null;
                    }
                    
                    saveUserData();
                    checkPremiumStatus();
                    initShop(); // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞–≥–∞–∑–∏–Ω, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–º–∏—É–º –∑–¥–∞–Ω–∏—è
                    
                    showNotification(`–ü—Ä–µ–º–∏—É–º —Å—Ç–∞—Ç—É—Å –Ω–∞ ${duration} —É—Å–ø–µ—à–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!`);
                    
                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                    document.getElementById('premium-modal').classList.remove('active');
                } else {
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ –ø—Ä–µ–º–∏—É–º —Å—Ç–∞—Ç—É—Å–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.', 'error');
                }
            }, 2000);
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = 'notification';
            
            if (type === 'error') {
                notification.style.background = 'rgba(255, 0, 0, 0.7)';
            } else if (type === 'success') {
                notification.style.background = 'rgba(0, 128, 0, 0.7)';
            } else {
                notification.style.background = 'rgba(0, 0, 0, 0.7)';
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –∑–∞–≥—Ä—É–∑–∫—É
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'flex' : 'none';
        }
    </script>
</body>
</html>
